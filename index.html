<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrossRealm Gaming - Complete Blockchain Platform</title>
    <meta name="description" content="Play multiplayer games and earn CORE tokens with real-time blockchain settlements">
    
    <!-- External Dependencies -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a6fd8;
            --secondary: #f093fb;
            --accent: #4ecdc4;
            --success: #00d4aa;
            --danger: #ff6b6b;
            --warning: #feca57;
            --dark: #0c0c0c;
            --dark-light: #1a1a1a;
            --light: #ffffff;
            --gray: #666;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-game: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            --gradient-gold: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            --shadow-soft: 0 10px 40px rgba(0,0,0,0.1);
            --shadow-strong: 0 20px 60px rgba(0,0,0,0.3);
            --border-radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: radial-gradient(ellipse at top, #1e3c72 0%, #2a5298 50%, #0c0c0c 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-soft);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            min-height: 44px;
            justify-content: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .btn-primary { background: var(--gradient-primary); color: white; }
        .btn-game { background: var(--gradient-game); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(12, 12, 12, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 16px 24px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo i {
            font-size: 32px;
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rotate 3s ease-in-out infinite;
        }

        @keyframes rotate {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .nav-menu {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .nav-item {
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
            position: relative;
            overflow: hidden;
        }

        .nav-item:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-item.active {
            color: white;
            background: var(--gradient-primary);
        }

        .wallet-section {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .wallet-info {
            text-align: right;
        }

        .connection-status {
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--danger);
            animation: pulse 2s infinite;
        }

        .status-dot.connected {
            background: var(--success);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .balance {
            font-size: 18px;
            font-weight: 700;
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Main Layout */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 24px;
            min-height: calc(100vh - 100px);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .sidebar-card {
            padding: 24px;
        }

        .content-area {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Live Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .stat-card {
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Game Cards */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .game-card {
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .game-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-strong);
        }

        .game-card.selected {
            border: 2px solid var(--accent);
            background: rgba(78, 205, 196, 0.1);
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .game-type {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 600;
        }

        .game-icon {
            font-size: 24px;
        }

        .game-stake {
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .game-info {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .game-meta {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            font-size: 14px;
            color: var(--gray);
            flex-wrap: wrap;
        }

        .game-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--light);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.2);
        }

        /* Game Window */
        .game-window {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: none;
            backdrop-filter: blur(10px);
        }

        .game-window.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .game-container {
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-rows: auto 1fr;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .game-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .game-controls {
            display: flex;
            gap: 12px;
        }

        .game-board-area {
            display: flex;
            gap: 24px;
            flex: 1;
        }

        .board-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .game-sidebar {
            width: 300px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .player-info {
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
        }

        .player-name {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .player-stats {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: var(--gray);
        }

        /* Chess & Checkers Board */
        .chess-board, .checkers-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            width: 480px;
            height: 480px;
            border: 2px solid var(--accent);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-strong);
        }

        .chess-square, .checkers-square {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .chess-square.light, .checkers-square.light {
            background: #f0d9b5;
            color: #8b4513;
        }

        .chess-square.dark, .checkers-square.dark {
            background: #b58863;
            color: #f0d9b5;
        }

        .chess-square:hover, .checkers-square:hover {
            box-shadow: inset 0 0 0 3px var(--accent);
        }

        .chess-square.selected, .checkers-square.selected {
            box-shadow: inset 0 0 0 3px #ffd700;
            background-color: rgba(255, 215, 0, 0.3);
        }

        .chess-square.legal-move::after, .checkers-square.legal-move::after {
            content: '';
            position: absolute;
            width: 30%;
            height: 30%;
            background: rgba(0, 255, 0, 0.6);
            border-radius: 50%;
        }

        .checker-piece {
            width: 80%;
            height: 80%;
            border-radius: 50%;
            border: 3px solid #333;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .checker-piece.red-piece {
            background: radial-gradient(circle at 30% 30%, #ff6b6b, #dc3545);
        }

        .checker-piece.black-piece {
            background: radial-gradient(circle at 30% 30%, #6c757d, #343a40);
        }

        .checker-piece:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(78, 205, 196, 0.5);
        }

        /* Chat System */
        .game-chat {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            padding: 16px;
            height: 300px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 12px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .chat-message {
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 6px;
            font-size: 14px;
        }

        .chat-message.system {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
            border-left: 3px solid #ffc107;
        }

        .chat-message.player {
            background: rgba(78, 205, 196, 0.1);
            color: var(--accent);
            border-left: 3px solid var(--accent);
        }

        .chat-message.opponent {
            background: rgba(255, 107, 107, 0.1);
            color: #ff6b6b;
            border-left: 3px solid #ff6b6b;
        }

        .chat-input {
            display: flex;
            gap: 8px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 14px;
        }

        .chat-input input:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            backdrop-filter: blur(10px);
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal {
            background: var(--dark-light);
            border-radius: var(--border-radius);
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            max-width: 400px;
            padding: 16px 20px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 500;
            box-shadow: var(--shadow-strong);
            z-index: 4000;
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success), #00b894);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger), #e84393);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                padding: 16px;
                gap: 16px;
            }

            .sidebar {
                order: 2;
            }

            .content-area {
                order: 1;
            }

            .header-content {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .nav-menu {
                justify-content: center;
                flex-wrap: wrap;
                width: 100%;
            }

            .nav-item {
                padding: 8px 16px;
                font-size: 14px;
            }

            .chess-board, .checkers-board {
                width: 320px;
                height: 320px;
            }

            .chess-square, .checkers-square {
                font-size: 20px;
            }

            .game-board-area {
                flex-direction: column;
            }

            .game-sidebar {
                width: 100%;
            }

            .games-grid {
                grid-template-columns: 1fr;
            }

            .game-actions {
                justify-content: center;
            }

            .wallet-section {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 12px 16px;
            }
            
            .logo {
                font-size: 20px;
            }
            
            .nav-item {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .chess-board, .checkers-board {
                width: 280px;
                height: 280px;
            }
            
            .game-container {
                padding: 10px;
            }
            
            .modal {
                margin: 20px;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-chess-king"></i>
                CrossRealm Gaming
            </div>
            
            <nav class="nav-menu">
                <div class="nav-item active" data-section="lobby">
                    <i class="fas fa-gamepad"></i> Game Lobby
                </div>
                <div class="nav-item" data-section="create">
                    <i class="fas fa-plus-circle"></i> Create Game
                </div>
                <div class="nav-item" data-section="tournaments">
                    <i class="fas fa-trophy"></i> Tournaments
                </div>
                <div class="nav-item" data-section="leaderboard">
                    <i class="fas fa-crown"></i> Leaderboard
                </div>
                <div class="nav-item" data-section="profile">
                    <i class="fas fa-user-circle"></i> Profile
                </div>
            </nav>
            
            <div class="wallet-section">
                <div class="wallet-info">
                    <div class="connection-status">
                        <span class="status-dot" id="statusDot"></span>
                        <span id="connectionText">Disconnected</span>
                    </div>
                    <div class="balance" id="balanceDisplay">0.0000 CORE</div>
                </div>
                <button class="btn btn-primary" id="connectBtn">
                    <i class="fas fa-wallet"></i> Connect Wallet
                </button>
                <button class="btn btn-danger" id="disconnectBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> Disconnect
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Live Stats -->
            <div class="sidebar-card glass-card">
                <h3><i class="fas fa-chart-line"></i> Live Platform Stats</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="onlinePlayers">247</div>
                        <div class="stat-label">Online Players</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeGames">89</div>
                        <div class="stat-label">Active Games</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="dailyVolume">156.7</div>
                        <div class="stat-label">24h Volume</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalPrizePool">423.2</div>
                        <div class="stat-label">Prize Pool</div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="sidebar-card glass-card">
                <h3><i class="fas fa-activity"></i> Recent Activity</h3>
                <div id="activityFeed" style="margin-top: 16px; max-height: 200px; overflow-y: auto;">
                    <div style="padding: 8px; margin-bottom: 4px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 13px;">
                        üéÆ ChessMaster won 0.5 CORE!
                    </div>
                    <div style="padding: 8px; margin-bottom: 4px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 13px;">
                        üèÜ Tournament starting in 5 minutes
                    </div>
                    <div style="padding: 8px; margin-bottom: 4px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 13px;">
                        ‚ö° New high-stakes game: 2.0 CORE
                    </div>
                </div>
            </div>

            <!-- Top Players -->
            <div class="sidebar-card glass-card">
                <h3><i class="fas fa-medal"></i> Top Players Today</h3>
                <div id="topPlayers" style="margin-top: 16px;">
                    <div style="display: flex; align-items: center; gap: 12px; padding: 8px; margin-bottom: 8px; background: rgba(255,215,0,0.1); border-radius: 6px;">
                        <div style="font-size: 20px;">ü•á</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 14px;">CryptoKing</div>
                            <div style="font-size: 12px; color: #666;">15 wins</div>
                        </div>
                        <div style="color: var(--accent); font-weight: 600;">127pts</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; padding: 8px; margin-bottom: 8px; background: rgba(192,192,192,0.1); border-radius: 6px;">
                        <div style="font-size: 20px;">ü•à</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 14px;">GameMaster</div>
                            <div style="font-size: 12px; color: #666;">12 wins</div>
                        </div>
                        <div style="color: var(--accent); font-weight: 600;">89pts</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; padding: 8px; background: rgba(205,127,50,0.1); border-radius: 6px;">
                        <div style="font-size: 20px;">ü•â</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 14px;">ChessGM</div>
                            <div style="font-size: 12px; color: #666;">8 wins</div>
                        </div>
                        <div style="color: var(--accent); font-weight: 600;">76pts</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content-area">
            <!-- Game Lobby Section -->
            <section id="lobby" class="section active">
                <div class="glass-card" style="padding: 32px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
                        <h2><i class="fas fa-gamepad"></i> Active Games</h2>
                        <div style="display: flex; gap: 12px;">
                            <select id="gameFilter" class="form-input" style="width: auto; min-width: 120px;">
                                <option value="all">All Games</option>
                                <option value="chess">Chess</option>
                                <option value="checkers">Checkers</option>
                            </select>
                            <select id="stakeFilter" class="form-input" style="width: auto; min-width: 120px;">
                                <option value="all">All Stakes</option>
                                <option value="low">0.1 - 1.0 CORE</option>
                                <option value="medium">1.0 - 5.0 CORE</option>
                                <option value="high">5.0+ CORE</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="games-grid" id="gamesGrid">
                        <!-- Game cards will be populated by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- Create Game Section -->
            <section id="create" class="section">
                <div class="glass-card" style="padding: 32px;">
                    <h2><i class="fas fa-plus-circle"></i> Create New Game</h2>
                    
                    <form id="createGameForm" style="margin-top: 24px;">
                        <div class="form-group">
                            <label class="form-label">Game Type</label>
                            <select id="gameType" class="form-input" required>
                                <option value="">Select Game Type</option>
                                <option value="chess">Chess Masters</option>
                                <option value="checkers">Checkers Pro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Stake Amount (CORE)</label>
                            <input type="number" id="stakeAmount" class="form-input" min="0.1" max="100" step="0.1" placeholder="0.5" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Time Control</label>
                            <select id="timeControl" class="form-input" required>
                                <option value="">Select Time Control</option>
                                <option value="bullet">Bullet (1 min)</option>
                                <option value="blitz">Blitz (5 min)</option>
                                <option value="rapid">Rapid (15 min)</option>
                                <option value="classical">Classical (30 min)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Privacy</label>
                            <select id="gamePrivacy" class="form-input" required>
                                <option value="public">Public - Anyone can join</option>
                                <option value="private">Private - Invite only</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Game Description (Optional)</label>
                            <textarea id="gameDescription" class="form-input" rows="3" placeholder="Add a description or challenge message..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-rocket"></i> Create Game
                        </button>
                    </form>
                </div>
            </section>

            <!-- Tournaments Section -->
            <section id="tournaments" class="section">
                <div class="glass-card" style="padding: 32px;">
                    <h2><i class="fas fa-trophy"></i> Tournaments</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 24px;">
                        <div class="glass-card" style="padding: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <h3>üèÜ Weekly Championship</h3>
                                <span style="color: var(--accent); font-weight: 600;">25.0 CORE</span>
                            </div>
                            <p style="color: rgba(255,255,255,0.7); margin-bottom: 16px;">
                                Swiss system tournament with 6 rounds. All skill levels welcome!
                            </p>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 16px; font-size: 14px; color: var(--gray);">
                                <span>Players: 24/32</span>
                                <span>Starts: 2h 15m</span>
                            </div>
                            <button class="btn btn-success" style="width: 100%;">
                                <i class="fas fa-user-plus"></i> Join Tournament
                            </button>
                        </div>
                        
                        <div class="glass-card" style="padding: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <h3>‚ö° Blitz Arena</h3>
                                <span style="color: var(--accent); font-weight: 600;">15.5 CORE</span>
                            </div>
                            <p style="color: rgba(255,255,255,0.7); margin-bottom: 16px;">
                                Fast-paced 5-minute games. Score points for every win!
                            </p>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 16px; font-size: 14px; color: var(--gray);">
                                <span>Players: 18/‚àû</span>
                                <span>Live Now</span>
                            </div>
                            <button class="btn btn-game" style="width: 100%;">
                                <i class="fas fa-bolt"></i> Join Arena
                            </button>
                        </div>
                        
                        <div class="glass-card" style="padding: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <h3>üëë Grand Masters</h3>
                                <span style="color: var(--accent); font-weight: 600;">100.0 CORE</span>
                            </div>
                            <p style="color: rgba(255,255,255,0.7); margin-bottom: 16px;">
                                Elite tournament for top-rated players. Minimum ELO: 2000
                            </p>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 16px; font-size: 14px; color: var(--gray);">
                                <span>Players: 8/16</span>
                                <span>Starts: Tomorrow</span>
                            </div>
                            <button class="btn btn-primary" style="width: 100%;">
                                <i class="fas fa-crown"></i> Register
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Leaderboard Section -->
            <section id="leaderboard" class="section">
                <div class="glass-card" style="padding: 32px;">
                    <h2><i class="fas fa-crown"></i> Global Leaderboard</h2>
                    
                    <div style="margin-top: 24px;">
                        <div style="display: grid; grid-template-columns: 60px 1fr 120px 120px 120px; gap: 16px; padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); font-weight: 600; color: var(--gray);">
                            <div>Rank</div>
                            <div>Player</div>
                            <div>Rating</div>
                            <div>Games</div>
                            <div>Winnings</div>
                        </div>
                        
                        <div id="leaderboardList">
                            <!-- Leaderboard entries populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Profile Section -->
            <section id="profile" class="section">
                <div class="glass-card" style="padding: 32px;">
                    <h2><i class="fas fa-user-circle"></i> Player Profile</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 24px;">
                        <div>
                            <h3>Statistics</h3>
                            <div style="margin-top: 16px;">
                                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                    <span>Games Played</span>
                                    <span style="font-weight: 600;">147</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                    <span>Win Rate</span>
                                    <span style="font-weight: 600; color: var(--success);">68.7%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                    <span>Total Winnings</span>
                                    <span style="font-weight: 600; color: var(--accent);">47.3 CORE</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                    <span>Current Rating</span>
                                    <span style="font-weight: 600;">1847</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px 0;">
                                    <span>Rank</span>
                                    <span style="font-weight: 600; color: var(--warning);">#23</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3>Recent Games</h3>
                            <div style="margin-top: 16px;">
                                <div style="padding: 12px; margin-bottom: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>vs GameMaster</span>
                                        <span style="color: var(--success); font-weight: 600;">+0.5 CORE</span>
                                    </div>
                                    <div style="font-size: 12px; color: var(--gray); margin-top: 4px;">Chess ‚Ä¢ 5 minutes ago</div>
                                </div>
                                <div style="padding: 12px; margin-bottom: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>vs ChessGM</span>
                                        <span style="color: var(--danger); font-weight: 600;">-0.3 CORE</span>
                                    </div>
                                    <div style="font-size: 12px; color: var(--gray); margin-top: 4px;">Chess ‚Ä¢ 1 hour ago</div>
                                </div>
                                <div style="padding: 12px; margin-bottom: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>vs CheckerKing</span>
                                        <span style="color: var(--success); font-weight: 600;">+1.0 CORE</span>
                                    </div>
                                    <div style="font-size: 12px; color: var(--gray); margin-top: 4px;">Checkers ‚Ä¢ 2 hours ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Game Window -->
    <div class="game-window" id="gameWindow">
        <div class="game-container">
            <div class="game-header-bar">
                <div class="game-title" id="gameTitle">
                    <i class="fas fa-chess"></i>
                    <span>Chess Masters</span>
                </div>
                <div class="game-controls">
                    <button class="btn btn-danger" id="resignBtn">
                        <i class="fas fa-flag"></i> Resign
                    </button>
                    <button class="btn btn-primary" id="closeGameBtn">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
            
            <div class="game-board-area">
                <div class="board-container">
                    <div id="chessBoard" class="chess-board" style="display: none;">
                        <!-- Chess board squares populated by JavaScript -->
                    </div>
                    <div id="checkersBoard" class="checkers-board" style="display: none;">
                        <!-- Checkers board squares populated by JavaScript -->
                    </div>
                </div>
                
                <div class="game-sidebar">
                    <div class="player-info">
                        <div class="player-name" id="player1Name">You</div>
                        <div class="player-stats">
                            <span>Rating: <span id="player1Rating">1500</span></span>
                            <span>Time: <span id="player1Time">15:00</span></span>
                        </div>
                    </div>
                    
                    <div class="player-info">
                        <div class="player-name" id="player2Name">Opponent</div>
                        <div class="player-stats">
                            <span>Rating: <span id="player2Rating">1500</span></span>
                            <span>Time: <span id="player2Time">15:00</span></span>
                        </div>
                    </div>
                    
                    <div class="game-chat" id="gameChat">
                        <div class="chat-messages" id="chatMessages">
                            <div class="chat-message system">Game started! Good luck!</div>
                        </div>
                        <div class="chat-input">
                            <input type="text" id="chatInput" placeholder="Type a message..." maxlength="200">
                            <button class="btn btn-primary" id="sendChatBtn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Modal Title</h3>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Modal content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- JavaScript -->
    <script>
        const CONFIG = {
    // Replace 'your-netlify-site' with your actual Netlify site name
    WEBSOCKET_URL: 'wss://your-netlify-site.netlify.app/.netlify/functions/websocket',
    API_BASE_URL: 'https://your-netlify-site.netlify.app/.netlify/functions',
    
    GAME_SERVER: {
        RECONNECT_ATTEMPTS: 5,
        HEARTBEAT_INTERVAL: 30000,
        GAME_TIMEOUT: 300000,
        MOVE_TIMEOUT: 60000
    }
};
        // Global Variables
        let web3 = null;
        let account = null;
        let contract = null;
        let socket = null;
        let currentGame = null;
        let selectedSquare = null;
        let gameState = {};
        let isPlayerTurn = false;

        // Core Network Configuration
        const CORE_NETWORK = {
            chainId: '0x45C', // 1116 in hex
            chainName: 'Core Blockchain Mainnet',
            nativeCurrency: {
                name: 'Core',
                symbol: 'CORE',
                decimals: 18
            },
            rpcUrls: ['https://rpc.coredao.org/'],
            blockExplorerUrls: ['https://scan.coredao.org/']
        };

        // Contract Configuration
        const CONTRACT_ABI = [
            "function createGame(string gameType, uint256 stake) external payable",
            "function joinGame(uint256 gameId) external payable",
            "function submitMove(uint256 gameId, string move) external",
            "function endGame(uint256 gameId, address winner) external",
            "function getGame(uint256 gameId) external view returns (tuple)",
            "event GameCreated(uint256 indexed gameId, address indexed creator, string gameType, uint256 stake)",
            "event GameJoined(uint256 indexed gameId, address indexed player)",
            "event MoveMade(uint256 indexed gameId, address indexed player, string move)",
            "event GameEnded(uint256 indexed gameId, address indexed winner, uint256 prize)"
        ];

        const CONTRACT_ADDRESS = "0x7af2cB8f93D0a75E0ba39E974B4e968EAe49028A"; // Replace with actual contract

        // Chess Pieces Unicode
        const CHESS_PIECES = {
            'K': '‚ôî', 'Q': '‚ôï', 'R': '‚ôñ', 'B': '‚ôó', 'N': '‚ôò', 'P': '‚ôô',
            'k': '‚ôö', 'q': '‚ôõ', 'r': '‚ôú', 'b': '‚ôù', 'n': '‚ôû', 'p': '‚ôü'
        };

        // Initial Chess Board
        const INITIAL_CHESS_BOARD = [
            ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
            ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
            ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
        ];

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            initializeSocket();
            loadGames();
            updateStats();
            setupChessBoard();
            setupCheckersBoard();
        });

        // Initialize Application
        function initializeApp() {
            console.log('üéÆ CrossRealm Gaming Platform Initialized');
            
            // Check if MetaMask is available
            if (typeof window.ethereum !== 'undefined') {
                web3 = new ethers.providers.Web3Provider(window.ethereum);
                console.log('‚úÖ MetaMask detected');
            } else {
                console.log('‚ö†Ô∏è MetaMask not detected - Demo mode enabled');
                enableDemoMode();
            }

            // Initialize contract if web3 is available
            if (web3) {
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, web3);
            }
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const section = item.dataset.section;
                    switchSection(section);
                });
            });

            // Wallet Connection
            document.getElementById('connectBtn').addEventListener('click', connectWallet);
            document.getElementById('disconnectBtn').addEventListener('click', disconnectWallet);

            // Game Creation
            document.getElementById('createGameForm').addEventListener('submit', createGame);

            // Game Window
            document.getElementById('closeGameBtn').addEventListener('click', closeGame);
            document.getElementById('resignBtn').addEventListener('click', resignGame);

            // Chat
            document.getElementById('sendChatBtn').addEventListener('click', sendChatMessage);
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendChatMessage();
            });

            // Modal
            document.getElementById('modalClose').addEventListener('click', closeModal);
            document.getElementById('modalOverlay').addEventListener('click', (e) => {
                if (e.target === document.getElementById('modalOverlay')) closeModal();
            });

            // Filters
            document.getElementById('gameFilter').addEventListener('change', filterGames);
            document.getElementById('stakeFilter').addEventListener('change', filterGames);
        }

        function initializeSocket() {
    console.log('üîå Connecting to Netlify functions...');
    
    // Initialize connection to Netlify serverless functions
    gameBackend = new GameBackend();
}

        // Wallet Functions
        async function connectWallet() {
            try {
                if (!window.ethereum) {
                    showNotification('MetaMask not found! Please install MetaMask.', 'error');
                    return;
                }

                // Request account access
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                account = accounts[0];

                // Switch to Core Network
                await switchToCore();

                // Update UI
                updateWalletUI();
                
                // Get balance
                await updateBalance();

                showNotification('Wallet connected successfully!', 'success');

            } catch (error) {
                console.error('Error connecting wallet:', error);
                showNotification('Failed to connect wallet', 'error');
            }
        }

        async function switchToCore() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: CORE_NETWORK.chainId }],
                });
            } catch (switchError) {
                if (switchError.code === 4902) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [CORE_NETWORK],
                        });
                    } catch (addError) {
                        throw addError;
                    }
                } else {
                    throw switchError;
                }
            }
        }

        async function disconnectWallet() {
            account = null;
            web3 = null;
            contract = null;
            updateWalletUI();
            showNotification('Wallet disconnected', 'info');
        }

        function updateWalletUI() {
            const statusDot = document.getElementById('statusDot');
            const connectionText = document.getElementById('connectionText');
            const connectBtn = document.getElementById('connectBtn');
            const disconnectBtn = document.getElementById('disconnectBtn');

            if (account) {
                statusDot.classList.add('connected');
                connectionText.textContent = `${account.slice(0, 6)}...${account.slice(-4)}`;
                connectBtn.style.display = 'none';
                disconnectBtn.style.display = 'flex';
            } else {
                statusDot.classList.remove('connected');
                connectionText.textContent = 'Disconnected';
                connectBtn.style.display = 'flex';
                disconnectBtn.style.display = 'none';
            }
        }

        async function updateBalance() {
            if (!web3 || !account) return;

            try {
                const balance = await web3.getBalance(account);
                const balanceInCore = ethers.utils.formatEther(balance);
                document.getElementById('balanceDisplay').textContent = `${parseFloat(balanceInCore).toFixed(4)} CORE`;
            } catch (error) {
                console.error('Error fetching balance:', error);
            }
        }

        // Game Functions
        async function createGame(e) {
            e.preventDefault();

            if (!account) {
                showNotification('Please connect your wallet first', 'error');
                return;
            }

            const formData = new FormData(e.target);
            const gameData = {
                type: document.getElementById('gameType').value,
                stake: document.getElementById('stakeAmount').value,
                timeControl: document.getElementById('timeControl').value,
                privacy: document.getElementById('gamePrivacy').value,
                description: document.getElementById('gameDescription').value
            };

            try {
                showNotification('Creating game...', 'info');

                // In production, call smart contract
                if (contract) {
                    const signer = web3.getSigner();
                    const contractWithSigner = contract.connect(signer);
                    const stakeWei = ethers.utils.parseEther(gameData.stake);
                    
                    const tx = await contractWithSigner.createGame(
                        gameData.type,
                        stakeWei,
                        { value: stakeWei }
                    );
                    
                    await tx.wait();
                }

                // Demo mode - add to local games
                const newGame = {
                    id: Date.now(),
                    type: gameData.type,
                    stake: gameData.stake,
                    creator: account || 'Demo Player',
                    timeControl: gameData.timeControl,
                    status: 'waiting',
                    players: 1,
                    maxPlayers: 2
                };

                addGameToList(newGame);
                showNotification('Game created successfully!', 'success');
                
                // Switch to lobby
                switchSection('lobby');
                
                // Reset form
                e.target.reset();

            } catch (error) {
                console.error('Error creating game:', error);
                showNotification('Failed to create game', 'error');
            }
        }

        function loadGames() {
            const gamesGrid = document.getElementById('gamesGrid');
            
            // Demo games
            const demoGames = [
                {
                    id: 1,
                    type: 'chess',
                    stake: '0.5',
                    creator: 'ChessMaster',
                    timeControl: 'blitz',
                    status: 'waiting',
                    players: 1,
                    maxPlayers: 2,
                    description: 'Quick blitz game, all welcome!'
                },
                {
                    id: 2,
                    type: 'checkers',
                    stake: '1.0',
                    creator: 'CheckerKing',
                    timeControl: 'rapid',
                    status: 'waiting',
                    players: 1,
                    maxPlayers: 2,
                    description: 'Serious checkers match'
                },
                {
                    id: 3,
                    type: 'chess',
                    stake: '2.0',
                    creator: 'GrandMaster',
                    timeControl: 'classical',
                    status: 'live',
                    players: 2,
                    maxPlayers: 2,
                    description: 'High stakes classical game'
                }
            ];

            gamesGrid.innerHTML = '';
            demoGames.forEach(game => addGameToList(game));
        }

        function addGameToList(game) {
            const gamesGrid = document.getElementById('gamesGrid');
            const gameCard = createGameCard(game);
            gamesGrid.insertAdjacentHTML('afterbegin', gameCard);
        }

        function createGameCard(game) {
            const gameIcon = game.type === 'chess' ? 'fa-chess' : 'fa-circle';
            const statusColor = game.status === 'waiting' ? 'var(--accent)' : 'var(--warning)';
            const statusText = game.status === 'waiting' ? 'Waiting for opponent' : 'Live Game';

            return `
                <div class="game-card glass-card" data-game-id="${game.id}">
                    <div class="game-header">
                        <div class="game-type">
                            <i class="fas ${gameIcon} game-icon"></i>
                            ${game.type === 'chess' ? 'Chess Masters' : 'Checkers Pro'}
                        </div>
                        <div class="game-stake">${game.stake} CORE</div>
                    </div>
                    
                    <div class="game-info">
                        ${game.description || 'No description provided'}
                    </div>
                    
                    <div class="game-meta">
                        <span><i class="fas fa-user"></i> ${game.creator}</span>
                        <span><i class="fas fa-clock"></i> ${game.timeControl}</span>
                        <span><i class="fas fa-users"></i> ${game.players}/${game.maxPlayers}</span>
                    </div>
                    
                    <div style="margin-bottom: 16px; color: ${statusColor}; font-weight: 600; font-size: 14px;">
                        <i class="fas fa-circle" style="font-size: 8px; margin-right: 8px;"></i>
                        ${statusText}
                    </div>
                    
                    <div class="game-actions">
                        ${game.status === 'waiting' ? 
                            `<button class="btn btn-game" onclick="joinGame(${game.id})">
                                <i class="fas fa-play"></i> Join Game
                            </button>` :
                            `<button class="btn btn-primary" onclick="spectateGame(${game.id})">
                                <i class="fas fa-eye"></i> Spectate
                            </button>`
                        }
                        <button class="btn btn-primary" onclick="viewGameDetails(${game.id})">
                            <i class="fas fa-info-circle"></i> Details
                        </button>
                    </div>
                    </div>
            `;
        }

        async function joinGame(gameId) {
            if (!account) {
                showNotification('Please connect your wallet first', 'error');
                return;
            }

            try {
                showNotification('Joining game...', 'info');

                // In production, call smart contract
                if (contract) {
                    const signer = web3.getSigner();
                    const contractWithSigner = contract.connect(signer);
                    const game = await contract.getGame(gameId);
                    
                    const tx = await contractWithSigner.joinGame(gameId, {
                        value: game.stake
                    });
                    
                    await tx.wait();
                }

                // Demo mode - start game
                currentGame = {
                    id: gameId,
                    type: 'chess', // Default for demo
                    stake: '0.5',
                    players: [account || 'You', 'Opponent']
                };

                startGame(currentGame);
                showNotification('Joined game successfully!', 'success');

            } catch (error) {
                console.error('Error joining game:', error);
                showNotification('Failed to join game', 'error');
            }
        }

        function spectateGame(gameId) {
            showNotification('Spectating feature coming soon!', 'info');
        }

        function viewGameDetails(gameId) {
            showModal('Game Details', `
                <div style="text-align: center;">
                    <h4>Game #${gameId}</h4>
                    <p>Detailed game information and history would appear here.</p>
                    <button class="btn btn-primary" onclick="closeModal()">Close</button>
                </div>
            `);
        }

        function startGame(game) {
            currentGame = game;
            document.getElementById('gameWindow').classList.add('active');
            
            // Setup game based on type
            if (game.type === 'chess') {
                setupChessGame();
            } else if (game.type === 'checkers') {
                setupCheckersGame();
            }

            addChatMessage('system', `Game started! Stake: ${game.stake} CORE`);
        }

        function closeGame() {
            document.getElementById('gameWindow').classList.remove('active');
            currentGame = null;
            selectedSquare = null;
            gameState = {};
        }

        function resignGame() {
            if (!currentGame) return;

            showModal('Resign Game', `
                <div style="text-align: center;">
                    <p>Are you sure you want to resign this game?</p>
                    <p style="color: var(--danger); margin: 16px 0;">You will lose your stake of ${currentGame.stake} CORE</p>
                    <div style="display: flex; gap: 12px; justify-content: center; margin-top: 24px;">
                        <button class="btn btn-primary" onclick="closeModal()">Cancel</button>
                        <button class="btn btn-danger" onclick="confirmResign()">Resign</button>
                    </div>
                </div>
            `);
        }

        function confirmResign() {
            addChatMessage('system', 'You resigned the game');
            showNotification('Game resigned', 'info');
            closeModal();
            closeGame();
        }

        // Chess Game Functions
        function setupChessBoard() {
            const board = document.getElementById('chessBoard');
            board.innerHTML = '';

            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `chess-square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
                    square.dataset.row = row;
                    square.dataset.col = col;
                    square.addEventListener('click', () => handleChessSquareClick(row, col));
                    
                    const piece = INITIAL_CHESS_BOARD[row][col];
                    if (piece) {
                        square.textContent = CHESS_PIECES[piece];
                    }
                    
                    board.appendChild(square);
                }
            }
        }

        function setupChessGame() {
            document.getElementById('chessBoard').style.display = 'grid';
            document.getElementById('checkersBoard').style.display = 'none';
            document.getElementById('gameTitle').innerHTML = '<i class="fas fa-chess"></i> Chess Masters';
            
            gameState = {
                board: JSON.parse(JSON.stringify(INITIAL_CHESS_BOARD)),
                currentPlayer: 'white',
                moveHistory: [],
                isCheck: false,
                isCheckmate: false
            };

            isPlayerTurn = true; // White starts
            updateChessBoard();
        }

        function handleChessSquareClick(row, col) {
            if (!isPlayerTurn) return;

            const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            
            if (selectedSquare) {
                // Attempt to move
                const fromRow = parseInt(selectedSquare.dataset.row);
                const fromCol = parseInt(selectedSquare.dataset.col);
                
                if (isValidChessMove(fromRow, fromCol, row, col)) {
                    makeChessMove(fromRow, fromCol, row, col);
                    selectedSquare.classList.remove('selected');
                    selectedSquare = null;
                    clearLegalMoves();
                } else {
                    // Select new square if it has a piece
                    selectedSquare.classList.remove('selected');
                    clearLegalMoves();
                    
                    if (gameState.board[row][col] && isPlayerPiece(gameState.board[row][col])) {
                        selectedSquare = square;
                        square.classList.add('selected');
                        showLegalMoves(row, col);
                    } else {
                        selectedSquare = null;
                    }
                }
            } else {
                // Select square if it has a player's piece
                if (gameState.board[row][col] && isPlayerPiece(gameState.board[row][col])) {
                    selectedSquare = square;
                    square.classList.add('selected');
                    showLegalMoves(row, col);
                }
            }
        }

        function isPlayerPiece(piece) {
            // For demo, player is always white (uppercase pieces)
            return piece === piece.toUpperCase();
        }

        function isValidChessMove(fromRow, fromCol, toRow, toCol) {
            // Simplified validation for demo
            const piece = gameState.board[fromRow][fromCol];
            if (!piece) return false;

            const targetPiece = gameState.board[toRow][toCol];
            if (targetPiece && isPlayerPiece(targetPiece)) return false; // Can't capture own piece

            // Basic piece movement validation (simplified)
            const rowDiff = Math.abs(toRow - fromRow);
            const colDiff = Math.abs(toCol - fromCol);

            switch (piece.toLowerCase()) {
                case 'p': // Pawn
                    const direction = piece === 'P' ? -1 : 1;
                    const startRow = piece === 'P' ? 6 : 1;
                    
                    if (fromCol === toCol) { // Moving forward
                        if (toRow === fromRow + direction && !targetPiece) return true;
                        if (fromRow === startRow && toRow === fromRow + 2 * direction && !targetPiece) return true;
                    } else if (colDiff === 1 && toRow === fromRow + direction && targetPiece) {
                        return true; // Capture
                    }
                    return false;

                case 'r': // Rook
                    return (rowDiff === 0 || colDiff === 0) && isPathClear(fromRow, fromCol, toRow, toCol);

                case 'n': // Knight
                    return (rowDiff === 2 && colDiff === 1) || (rowDiff === 1 && colDiff === 2);

                case 'b': // Bishop
                    return rowDiff === colDiff && isPathClear(fromRow, fromCol, toRow, toCol);

                case 'q': // Queen
                    return (rowDiff === 0 || colDiff === 0 || rowDiff === colDiff) && 
                           isPathClear(fromRow, fromCol, toRow, toCol);

                case 'k': // King
                    return rowDiff <= 1 && colDiff <= 1;

                default:
                    return false;
            }
        }

        function isPathClear(fromRow, fromCol, toRow, toCol) {
            const rowStep = toRow > fromRow ? 1 : toRow < fromRow ? -1 : 0;
            const colStep = toCol > fromCol ? 1 : toCol < fromCol ? -1 : 0;
            
            let currentRow = fromRow + rowStep;
            let currentCol = fromCol + colStep;
            
            while (currentRow !== toRow || currentCol !== toCol) {
                if (gameState.board[currentRow][currentCol]) return false;
                currentRow += rowStep;
                currentCol += colStep;
            }
            
            return true;
        }

        function makeChessMove(fromRow, fromCol, toRow, toCol) {
            const piece = gameState.board[fromRow][fromCol];
            const capturedPiece = gameState.board[toRow][toCol];

            // Make the move
            gameState.board[toRow][toCol] = piece;
            gameState.board[fromRow][fromCol] = null;

            // Add to move history
            const moveNotation = `${String.fromCharCode(97 + fromCol)}${8 - fromRow}-${String.fromCharCode(97 + toCol)}${8 - toRow}`;
            gameState.moveHistory.push(moveNotation);

            // Update display
            updateChessBoard();

            // Switch turns
            gameState.currentPlayer = gameState.currentPlayer === 'white' ? 'black' : 'white';
            isPlayerTurn = false;

            // Add chat message
            const moveMsg = capturedPiece ? `${piece} captures on ${String.fromCharCode(97 + toCol)}${8 - toRow}` : 
                                          `${piece} to ${String.fromCharCode(97 + toCol)}${8 - toRow}`;
            addChatMessage('player', moveMsg);

            // Simulate opponent move after delay
            setTimeout(() => {
                makeRandomOpponentMove();
            }, 1500);
        }

        function makeRandomOpponentMove() {
            // Simple AI for demo - make a random valid move
            const opponentPieces = [];
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const piece = gameState.board[row][col];
                    if (piece && piece === piece.toLowerCase()) { // Black pieces
                        opponentPieces.push({ piece, row, col });
                    }
                }
            }

            // Try to find a valid move
            for (let i = 0; i < 50; i++) { // Max attempts
                const randomPiece = opponentPieces[Math.floor(Math.random() * opponentPieces.length)];
                const toRow = Math.floor(Math.random() * 8);
                const toCol = Math.floor(Math.random() * 8);

                if (isValidChessMove(randomPiece.row, randomPiece.col, toRow, toCol)) {
                    // Make opponent move
                    const capturedPiece = gameState.board[toRow][toCol];
                    gameState.board[toRow][toCol] = randomPiece.piece;
                    gameState.board[randomPiece.row][randomPiece.col] = null;

                    updateChessBoard();
                    
                    const moveMsg = `Opponent: ${randomPiece.piece} to ${String.fromCharCode(97 + toCol)}${8 - toRow}`;
                    addChatMessage('opponent', moveMsg);

                    isPlayerTurn = true;
                    gameState.currentPlayer = 'white';
                    break;
                }
            }
        }

        function updateChessBoard() {
            const squares = document.querySelectorAll('.chess-square');
            squares.forEach((square, index) => {
                const row = Math.floor(index / 8);
                const col = index % 8;
                const piece = gameState.board[row][col];
                square.textContent = piece ? CHESS_PIECES[piece] : '';
            });
        }

        function showLegalMoves(row, col) {
            // Show possible moves for demo (simplified)
            const possibleMoves = [];
            
            for (let toRow = 0; toRow < 8; toRow++) {
                for (let toCol = 0; toCol < 8; toCol++) {
                    if (isValidChessMove(row, col, toRow, toCol)) {
                        possibleMoves.push({ row: toRow, col: toCol });
                    }
                }
            }

            possibleMoves.forEach(move => {
                const square = document.querySelector(`[data-row="${move.row}"][data-col="${move.col}"]`);
                square.classList.add('legal-move');
            });
        }

        function clearLegalMoves() {
            document.querySelectorAll('.legal-move').forEach(square => {
                square.classList.remove('legal-move');
            });
        }

        // Checkers Game Functions
        function setupCheckersBoard() {
            const board = document.getElementById('checkersBoard');
            board.innerHTML = '';

            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `checkers-square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
                    square.dataset.row = row;
                    square.dataset.col = col;
                    square.addEventListener('click', () => handleCheckersSquareClick(row, col));
                    
                    // Add initial pieces
                    if ((row + col) % 2 === 1) { // Dark squares only
                        if (row < 3) {
                            const piece = document.createElement('div');
                            piece.className = 'checker-piece black-piece';
                            square.appendChild(piece);
                        } else if (row > 4) {
                            const piece = document.createElement('div');
                            piece.className = 'checker-piece red-piece';
                            square.appendChild(piece);
                        }
                    }
                    
                    board.appendChild(square);
                }
            }
        }

        function setupCheckersGame() {
            document.getElementById('checkersBoard').style.display = 'grid';
            document.getElementById('chessBoard').style.display = 'none';
            document.getElementById('gameTitle').innerHTML = '<i class="fas fa-circle"></i> Checkers Pro';
            
            gameState = {
                currentPlayer: 'red',
                moveHistory: [],
                selectedPiece: null
            };

            isPlayerTurn = true; // Red starts
            addChatMessage('system', 'Checkers game started! Red pieces move first.');
        }

        function handleCheckersSquareClick(row, col) {
            if (!isPlayerTurn) return;

            const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            const piece = square.querySelector('.checker-piece');

            if (selectedSquare && selectedSquare !== square) {
                // Try to move
                if (isValidCheckersMove(selectedSquare, square)) {
                    makeCheckersMove(selectedSquare, square);
                }
                clearCheckersSelection();
            } else if (piece && piece.classList.contains('red-piece')) {
                // Select red piece
                clearCheckersSelection();
                selectedSquare = square;
                square.classList.add('selected');
            } else {
                clearCheckersSelection();
            }
        }

        function isValidCheckersMove(fromSquare, toSquare) {
            const fromRow = parseInt(fromSquare.dataset.row);
            const fromCol = parseInt(fromSquare.dataset.col);
            const toRow = parseInt(toSquare.dataset.row);
            const toCol = parseInt(toSquare.dataset.col);

            // Must be diagonal
            if (Math.abs(toRow - fromRow) !== Math.abs(toCol - fromCol)) return false;

            // Must be to empty square
            if (toSquare.querySelector('.checker-piece')) return false;

            // Regular move (one square diagonally forward)
            if (Math.abs(toRow - fromRow) === 1 && toRow < fromRow) return true;

            // Jump move (two squares diagonally over opponent)
            if (Math.abs(toRow - fromRow) === 2) {
                const middleRow = (fromRow + toRow) / 2;
                const middleCol = (fromCol + toCol) / 2;
                const middleSquare = document.querySelector(`[data-row="${middleRow}"][data-col="${middleCol}"]`);
                const middlePiece = middleSquare.querySelector('.checker-piece');
                
                return middlePiece && middlePiece.classList.contains('black-piece');
            }

            return false;
        }

        function makeCheckersMove(fromSquare, toSquare) {
            const piece = fromSquare.querySelector('.checker-piece');
            const fromRow = parseInt(fromSquare.dataset.row);
            const fromCol = parseInt(fromSquare.dataset.col);
            const toRow = parseInt(toSquare.dataset.row);
            const toCol = parseInt(toSquare.dataset.col);

            // Move piece
            toSquare.appendChild(piece);

            // Check for jump
            if (Math.abs(toRow - fromRow) === 2) {
                const middleRow = (fromRow + toRow) / 2;
                const middleCol = (fromCol + toCol) / 2;
                const middleSquare = document.querySelector(`[data-row="${middleRow}"][data-col="${middleCol}"]`);
                const capturedPiece = middleSquare.querySelector('.checker-piece');
                
                if (capturedPiece) {
                    capturedPiece.remove();
                    addChatMessage('player', `Captured opponent piece!`);
                }
            }

            // Check for king promotion
            if (toRow === 0) {
                piece.style.border = '3px solid gold';
                piece.style.boxShadow = '0 0 10px rgba(255, 215, 0, 0.8)';
                addChatMessage('system', 'Piece promoted to King!');
            }

            addChatMessage('player', `Moved from ${String.fromCharCode(97 + fromCol)}${8 - fromRow} to ${String.fromCharCode(97 + toCol)}${8 - toRow}`);

            // Switch turns
            isPlayerTurn = false;
            setTimeout(() => {
                makeRandomCheckersMove();
            }, 1500);
        }

        function makeRandomCheckersMove() {
            // Simple AI for checkers demo
            const blackPieces = document.querySelectorAll('.black-piece');
            const validMoves = [];

            blackPieces.forEach(piece => {
                const square = piece.parentElement;
                const row = parseInt(square.dataset.row);
                const col = parseInt(square.dataset.col);

                // Check possible moves
                const directions = [[1, -1], [1, 1]]; // Forward diagonals for black
                
                directions.forEach(([dr, dc]) => {
                    const newRow = row + dr;
                    const newCol = col + dc;
                    
                    if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                        const targetSquare = document.querySelector(`[data-row="${newRow}"][data-col="${newCol}"]`);
                        if (!targetSquare.querySelector('.checker-piece')) {
                            validMoves.push({ from: square, to: targetSquare });
                        }
                    }
                });
            });

            if (validMoves.length > 0) {
                const randomMove = validMoves[Math.floor(Math.random() * validMoves.length)];
                const piece = randomMove.from.querySelector('.checker-piece');
                randomMove.to.appendChild(piece);

                addChatMessage('opponent', 'Opponent made a move');
                isPlayerTurn = true;
            }
        }

        function clearCheckersSelection() {
            document.querySelectorAll('.checkers-square.selected').forEach(square => {
                square.classList.remove('selected');
            });
            selectedSquare = null;
        }

        // Chat Functions
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message && currentGame) {
                addChatMessage('player', message);
                input.value = '';
                
                // Demo auto-response
                setTimeout(() => {
                    const responses = [
                        'Good move!', 'Nice strategy', 'Thanks for the game!', 
                        'Well played', 'Good luck!', 'Interesting position'
                    ];
                    const response = responses[Math.floor(Math.random() * responses.length)];
                    addChatMessage('opponent', response);
                }, 1000);
            }
        }

        function addChatMessage(type, message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${type}`;
            
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const sender = type === 'player' ? 'You' : type === 'opponent' ? 'Opponent' : 'System';
            
            messageDiv.innerHTML = `<strong>${sender}</strong> <span style="color: var(--gray); font-size: 12px;">${timestamp}</span><br>${message}`;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // UI Functions
        function switchSection(sectionName) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');

            // Update sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName).classList.add('active');

            // Load section-specific data
            if (sectionName === 'leaderboard') {
                loadLeaderboard();
            }
        }

        function loadLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            const demoPlayers = [
                { rank: 1, name: 'CryptoKing', rating: 2347, games: 89, winnings: '127.45' },
                { rank: 2, name: 'ChessMaster', rating: 2298, games: 156, winnings: '98.32' },
                { rank: 3, name: 'GameGuru', rating: 2245, games: 203, winnings: '89.67' },
                { rank: 4, name: 'BlockchainBoss', rating: 2198, games: 145, winnings: '76.23' },
                { rank: 5, name: 'TokenTrader', rating: 2156, games: 134, winnings: '65.89' }
            ];

            leaderboardList.innerHTML = '';
            demoPlayers.forEach(player => {
                const rankColor = player.rank === 1 ? '#ffd700' : player.rank === 2 ? '#c0c0c0' : player.rank === 3 ? '#cd7f32' : '#666';
                
                leaderboardList.innerHTML += `
                    <div style="display: grid; grid-template-columns: 60px 1fr 120px 120px 120px; gap: 16px; padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.05); align-items: center;">
                        <div style="color: ${rankColor}; font-weight: 600; font-size: 18px;">#${player.rank}</div>
                        <div>
                            <div style="font-weight: 600;">${player.name}</div>
                            <div style="font-size: 12px; color: var(--gray);">Active player</div>
                        </div>
                        <div style="color: var(--accent); font-weight: 600;">${player.rating}</div>
                        <div>${player.games}</div>
                        <div style="color: var(--success); font-weight: 600;">${player.winnings} CORE</div>
                    </div>
                `;
            });
        }

        function filterGames() {
            const gameFilter = document.getElementById('gameFilter').value;
            const stakeFilter = document.getElementById('stakeFilter').value;
            const gameCards = document.querySelectorAll('.game-card');

            gameCards.forEach(card => {
                let show = true;
                
                // Filter by game type
                if (gameFilter !== 'all') {
                    const hasChessIcon = card.querySelector('.fa-chess');
                    const isChess = hasChessIcon !== null;
                    if ((gameFilter === 'chess' && !isChess) || (gameFilter === 'checkers' && isChess)) {
                        show = false;
                    }
                }

                // Filter by stake
                if (stakeFilter !== 'all' && show) {
                    const stakeText = card.querySelector('.game-stake').textContent;
                    const stake = parseFloat(stakeText.split(' ')[0]);
                    
                    if (stakeFilter === 'low' && (stake < 0.1 || stake > 1.0)) show = false;
                    if (stakeFilter === 'medium' && (stake < 1.0 || stake > 5.0)) show = false;
                    if (stakeFilter === 'high' && stake < 5.0) show = false;
                }

                card.style.display = show ? 'block' : 'none';
            });
        }

        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;

            document.getElementById('notificationContainer').appendChild(notification);

            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            // Hide and remove notification
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        function updateStats() {
            // Simulate live stats updates
            setInterval(() => {
                const onlinePlayers = document.getElementById('onlinePlayers');
                const activeGames = document.getElementById('activeGames');
                const dailyVolume = document.getElementById('dailyVolume');
                const totalPrizePool = document.getElementById('totalPrizePool');

                // Simulate slight variations
                const currentPlayers = parseInt(onlinePlayers.textContent);
                onlinePlayers.textContent = Math.max(200, currentPlayers + Math.floor(Math.random() * 21) - 10);
                
                const currentGames = parseInt(activeGames.textContent);
                activeGames.textContent = Math.max(50, currentGames + Math.floor(Math.random() * 11) - 5);
                
                const currentVolume = parseFloat(dailyVolume.textContent);
                dailyVolume.textContent = (currentVolume + (Math.random() * 2) - 1).toFixed(1);
                
                const currentPrize = parseFloat(totalPrizePool.textContent);
                totalPrizePool.textContent = (Math.max(400, currentPrize + (Math.random() * 10) - 5)).toFixed(1);
            }, 5000);

            // Update balance periodically if connected
            setInterval(() => {
                if (account) {
                    updateBalance();
                }
            }, 30000);
        }

        function enableDemoMode() {
            console.log('üéÆ Demo mode enabled - All features available without wallet');
            showNotification('Demo mode active - Connect wallet for real blockchain features', 'info');
        }

        // Initialize everything when page loads
        console.log('üöÄ CrossRealm Gaming Platform Loaded Successfully!');
    </script>
</body>
</html>
