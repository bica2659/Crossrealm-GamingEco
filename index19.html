<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Crypticus - Live Blockchain Gaming Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4e54c8;
            --primary-dark: #363a9e;
            --secondary: #f39c12;
            --dark: #1a1c2c;
            --light: #f5f7fa;
            --danger: #e74c3c;
            --success: #2ecc71;
            --warning: #f1c40f;
            --gray: #95a5a6;
        }

        /* MOBILE & SCROLLING FIXES */
        html, body {
            height: 100%;
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }

        body {
            background: linear-gradient(135deg, #1a1c2c, #2c3e50);
            color: var(--light);
            min-height: 100vh;
            position: relative;
        }

        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://images.unsplash.com/photo-1620336655052-b57986f5a26a?q=80&w=1920') no-repeat center center;
            background-size: cover;
            opacity: 0.15;
            z-index: -1;
        }

        /* Enhanced background for iOS contrast */
        .background::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(26, 28, 44, 0.8), rgba(44, 62, 80, 0.8));
            z-index: 1;
        }

        .hidden {
            display: none;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #4ecdc4;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
    /* AGE VERIFICATION MODAL - SCROLLING FIXED */
        .age-verification {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .verification-content {
            background: var(--dark);
            border-radius: 16px;
            padding: 20px;
            max-width: 90vw;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--primary);
            margin: 20px;
        }

        .verification-content h1 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--secondary);
        }

        .verification-content p {
            font-size: 1rem;
            margin-bottom: 20px;
            line-height: 1.6;
            color: var(--light);
        }

        .verification-content .warning {
            background: rgba(231, 76, 60, 0.2);
            border-left: 4px solid var(--danger);
            padding: 10px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
            text-align: left;
            font-size: 0.9rem;
        }

        /* Mobile-specific modal fixes */
        @media (max-width: 768px) {
            .verification-content {
                padding: 15px;
                margin: 10px;
            }
            
            .verification-content h1 {
                font-size: 1.5rem;
            }
            
            .verification-content p {
                font-size: 0.9rem;
            }
            
            .verification-content button {
                display: block;
                width: 100%;
                margin: 0.5rem 0;
                padding: 1rem;
                font-size: 1rem;
                border: none;
                border-radius: 25px;
                font-weight: bold;
                cursor: pointer;
            }
        }

        /* iOS Safari specific fixes */
        @supports (-webkit-touch-callout: none) {
            .age-verification {
                height: 100vh;
                height: -webkit-fill-available;
            }
            
            .verification-content {
                max-height: 85vh;
                max-height: -webkit-fill-available;
            }
        }
  /* HEADER & NAVIGATION FIXES */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 200;
            background: linear-gradient(135deg, rgba(26, 28, 44, 0.95), rgba(44, 62, 80, 0.95));
            backdrop-filter: blur(15px);
            padding: 0.8rem 1rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            min-height: 70px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 1.8rem;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-icon {
            font-size: 2.5rem;
            color: var(--secondary);
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-item {
            padding: 0.5rem 1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(78, 205, 196, 0.5);
        }

        .nav-item.active {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }

        .live-badge {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #000;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.8rem;
            animation: pulse 2s infinite;
        }

        .wallet-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .wallet-info {
            text-align: right;
        }

        .connection-status {
            font-size: 0.9rem;
            color: #ff6b6b;
        }

        .balance {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .connect-btn, .disconnect-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .disconnect-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            margin-left: 0.5rem;
        }

        .connect-btn:hover, .disconnect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(78, 205, 196, 0.3);
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            margin-left: auto;
        }

        /* MOBILE NAVIGATION FIXES */
        @media (max-width: 768px) {
            .header {
                padding: 0.5rem;
                min-height: 60px;
                flex-direction: row;
                flex-wrap: nowrap;
            }
            
            .logo h1 {
                font-size: 1.3rem;
            }
            
            .mobile-menu-btn {
                display: block;
                order: 2;
                z-index: 300;
            }
            
            .nav-menu {
                position: fixed;
                top: 60px;
                left: -100%;
                width: 100%;
                height: calc(100vh - 60px);
                background: rgba(0, 0, 0, 0.98);
                backdrop-filter: blur(15px);
                flex-direction: column;
                justify-content: flex-start;
                align-items: stretch;
                padding: 1rem;
                gap: 1rem;
                transition: left 0.3s ease;
                z-index: 150;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .nav-menu.active {
                left: 0;
            }
            
            .nav-item {
                padding: 1rem;
                border-radius: 8px;
                text-align: center;
                font-size: 1.1rem;
                width: 100%;
                display: block;
            }
            
            .live-badge {
                order: 3;
                margin-left: auto;
                font-size: 0.7rem;
                padding: 0.3rem 0.8rem;
            }
            
            .wallet-section {
                order: 4;
                flex-direction: column;
                align-items: flex-end;
                gap: 0.3rem;
            }
            
            .wallet-info {
                font-size: 0.8rem;
            }
            
            .connect-btn, .disconnect-btn {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }
        }
  /* MAIN LAYOUT FIXES */
        .main-container {
            display: flex;
            min-height: 100vh;
            margin-top: 70px;
            overflow: hidden;
            position: relative;
            max-width: 100vw;
        }

        .sidebar {
            width: 300px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            overflow-y: auto;
            max-height: calc(100vh - 70px);
            -webkit-overflow-scrolling: touch;
        }

        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            max-height: calc(100vh - 70px);
            -webkit-overflow-scrolling: touch;
            max-width: calc(100vw - 300px);
        }

        /* TRANSACTION STATUS FIXES */
        .transaction-status {
            position: fixed;
            top: 80px;
            right: 10px;
            left: 10px;
            max-width: none;
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid #4ecdc4;
            border-radius: 10px;
            padding: 1rem;
            z-index: 9999;
            transform: translateY(-100px);
            transition: transform 0.3s ease;
            word-wrap: break-word;
        }

        .transaction-status.show {
            transform: translateY(0);
        }

        .tx-hash {
            font-family: monospace;
            font-size: 0.8rem;
            word-break: break-all;
            color: #4ecdc4;
            margin-top: 0.5rem;
            cursor: pointer;
        }

        /* GAME SECTION STYLES */
        .fee-info {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .fee-info h3 {
            color: #ffd700;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .fee-info p {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .legal-notice {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .legal-notice h4 {
            color: #ffd700;
            margin-bottom: 1rem;
        }

        .legal-notice p {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 2rem;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            border-color: var(--primary);
        }

        .create-game-btn {
            width: 100%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            padding: 1rem;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            margin-top: 1rem;
        }

        .create-game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
        }

        .stake-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 0.8rem;
            color: white;
            font-size: 1rem;
            margin: 1rem 0;
        }

        .stake-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* MOBILE LAYOUT FIXES */
        @media (max-width: 768px) {
            .main-container {
                margin-top: 60px;
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                order: 2;
                padding: 1rem;
                max-height: none;
            }
            
            .content-area {
                order: 1;
                padding: 1rem;
                max-height: none;
                max-width: 100vw;
            }
            
            .games-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .transaction-status {
                top: 70px;
                right: 5px;
                left: 5px;
                font-size: 0.9rem;
                padding: 0.8rem;
            }
        }

        /* PREVENT HORIZONTAL SCROLL */
        .main-container, .content-area, .sidebar {
            overflow-x: hidden;
        }
  /* GAME COMPONENTS & REMAINING STYLES */
        .active-games {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .game-lobby-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin: 0.5rem 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid #4ecdc4;
            transition: all 0.3s ease;
        }

        .game-lobby-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .join-game-btn {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            color: black;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .join-game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }

        /* GAME WINDOWS */
        .game-window {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(15px);
            border: 2px solid #4ecdc4;
            border-radius: 15px;
            padding: 1.5rem;
            z-index: 1000;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            min-width: 600px;
        }

        .game-window.minimized {
            top: auto;
            bottom: 20px;
            right: 20px;
            left: auto;
            transform: none;
            width: 300px;
            height: 60px;
            overflow: hidden;
            cursor: pointer;
        }

        .game-window-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .game-window-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4ecdc4;
        }

        .game-window-controls {
            display: flex;
            gap: 0.5rem;
        }

        .window-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            padding: 0.3rem 0.6rem;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .window-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .minimize-btn {
            background: rgba(255, 193, 7, 0.3);
        }

        .close-btn {
            background: rgba(220, 53, 69, 0.3);
        }

        .game-window-content {
            display: block;
        }

        .game-window.minimized .game-window-content {
            display: none;
        }

        .game-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 999;
        }

        /* GAME BOARDS */
        .chess-board, .checkers-board {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            border: 3px solid #4ecdc4;
            border-radius: 10px;
            margin: 1rem auto;
            background: #f4f4f4;
        }

        .chess-square, .checkers-square {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .chess-square.white, .checkers-square.light {
            background: #f0d9b5;
        }

        .chess-square.black, .checkers-square.dark {
            background: #b58863;
        }

        .chess-square.selected {
            background: #ff6b6b !important;
            box-shadow: inset 0 0 10px rgba(255, 107, 107, 0.5);
        }

        .chess-square.possible-move {
            background: rgba(78, 205, 196, 0.3) !important;
        }

        .chess-square.possible-move::after {
            content: '●';
            color: #4ecdc4;
            position: absolute;
            font-size: 1rem;
        }

        /* NEWS FEED & SIDEBAR */
        .news-feed {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .news-item {
            padding: 1rem;
            margin: 0.5rem 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid #4ecdc4;
        }

        .news-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #4ecdc4;
        }

        .news-time {
            font-size: 0.8rem;
            color: #aaa;
        }

        /* MOBILE GAME FIXES */
        @media (max-width: 768px) {
            .game-window {
                position: fixed;
                top: 5%;
                left: 5%;
                right: 5%;
                bottom: 5%;
                transform: none;
                width: auto;
                height: auto;
                min-width: auto;
                max-width: none;
                max-height: none;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .chess-board, .checkers-board {
                grid-template-columns: repeat(8, 40px);
                grid-template-rows: repeat(8, 40px);
            }
            
            .chess-square, .checkers-square {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="background"></div>
    
    <!-- Fixed Header -->
    <div class="header">
        <div class="logo">
            <i class="fas fa-dice-d20 logo-icon"></i>
            <h1>CRYPTICUS</h1>
        </div>
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()">☰</button>
        <div class="nav-menu" id="navMenu">
            <div class="nav-item active" onclick="showSection('games')">🎮 Games</div>
            <div class="nav-item" onclick="showSection('leaderboard')">🏆 Leaderboard</div>
            <div class="nav-item" onclick="showSection('profile')">👤 Profile</div>
            <div class="nav-item" onclick="showSection('chat')">💬 Chat</div>
            <div class="nav-item" onclick="showSection('news')">📰 News</div>
            <div class="nav-item" onclick="showSection('settings')">⚙️ Settings</div>
        </div>
        <div class="live-badge">🔴 LIVE ON CORE</div>
        <div class="wallet-section">
            <div class="wallet-info">
                <div class="connection-status" id="connectionStatus">🔴 Not Connected</div>
                <div class="balance" id="balanceDisplay">0.00 CORE</div>
            </div>
            <button class="connect-btn" id="connectBtn">
                <i class="fas fa-plug"></i> Connect Wallet
            </button>
            <button class="disconnect-btn hidden" id="disconnectBtn">Disconnect</button>
        </div>
    </div>

    <!-- Fixed Age Verification Modal -->
    <div class="age-verification" id="ageVerificationModal">
        <div class="verification-content">
            <h1><i class="fas fa-exclamation-triangle"></i> Age Verification Required</h1>
            <p>This platform contains blockchain-based games that involve financial stakes. You must be 18 years or older to access this content.</p>
            <div class="warning">
                <p><i class="fas fa-exclamation-circle"></i> Gambling involves risk. Please play responsibly. Only gamble with funds you can afford to lose.</p>
            </div>
            <p>By entering this site, you confirm that you are at least 18 years of age and agree to our Terms of Service.</p>
            <button onclick="verifyAge(true)" style="background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none; padding: 1rem 2rem; border-radius: 25px; color: white; font-weight: bold; margin: 0.5rem; cursor: pointer; width: 100%;">I am 18+</button>
            <button onclick="verifyAge(false)" style="background: linear-gradient(45deg, #ff6b6b, #ee5a52); border: none; padding: 1rem 2rem; border-radius: 25px; color: white; font-weight: bold; margin: 0.5rem; cursor: pointer; width: 100%;">Under 18</button>
        </div>
    </div>

    <!-- Transaction Status Popup -->
    <div class="transaction-status" id="transactionStatus">
        <div id="txStatusMessage">Processing transaction...</div>
        <div class="tx-hash" id="txHash"></div>
    </div>

    <!-- Game Overlay -->
    <div class="game-overlay hidden" id="gameOverlay"></div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="news-feed">
                <h3>📰 Live Game Feed</h3>
                <div id="gameFeed">
                    <div class="news-item">
                        <div class="news-title">🎮 Active Games: <span id="activeGameCount">0</span></div>
                        <div class="news-time">Players online now</div>
                    </div>
                    <div class="news-item">
                        <div class="news-title">💰 Total Pool: <span id="totalPool">0 CORE</span></div>
                        <div class="news-time">Live betting volume</div>
                    </div>
                    <div class="news-item">
                        <div class="news-title">🏆 Last Winner: <span id="lastWinner">--</span></div>
                        <div class="news-time">Recent game result</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Content Area -->
        <div class="content-area">
            <!-- Games Section -->
            <div id="gamesSection">
                <div class="fee-info">
                    <h3>🏆 Smart Contract Gaming</h3>
                    <p><strong>97% of every stake goes directly to the winner!</strong></p>
                    <p>Powered by Core Blockchain • Instant payouts • Provably fair</p>
                    <p>Contract Address: 0x7af2cB8f93D0a75E0ba39E974B4e968EAe49028A (Verified ✅)</p>
                </div>

                <div class="legal-notice">
                    <h4>⚖️ Legal Notice</h4>
                    <p>• Educational gaming platform for skill development</p>
                    <p>• Minimum age: 18+ required</p>
                    <p>• Tax obligations: Players responsible for local tax compliance</p>
                    <p>• Not available in restricted jurisdictions</p>
                </div>

                <!-- Active Games Lobby -->
                <div class="active-games">
                    <h3 style="color: #4ecdc4; margin-bottom: 1rem;">🎯 Active Games - Join Now!</h3>
                    <div id="activeGamesList">
                        <div id="noActiveGames" style="text-align: center; padding: 2rem; color: #aaa;">
                            No active games right now. Create one below! 🎮
                        </div>
                    </div>
                </div>

                <!-- Game Creation Section -->
                <div class="game-section">
                    <h2 style="font-size: 1.8rem; margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">🎮 Blockchain Games
                        <span class="live-badge">LIVE</span>
                    </h2>
                    <div class="games-grid">
                        <div class="game-card" id="chessCard">
                            <h3>
                                <i class="fas fa-chess game-icon"></i>
                                Chess Masters
                            </h3>
                            <p>Play chess with real CORE stakes! Smart contract ensures fair play.</p>
                            <input type="number" class="stake-input" id="chessStake" placeholder="Enter stake (min 0.01 CORE)" min="0.01" step="0.01">
                            <button class="create-game-btn" onclick="createChessGame()">
                                <i class="fas fa-chess-board"></i> Create Chess Game
                            </button>
                        </div>

                        <div class="game-card" id="checkersCard">
                            <h3>
                                <i class="fas fa-th game-icon"></i>
                                Checkers Pro
                            </h3>
                            <p>Fast checkers with blockchain stakes! Quick games, instant rewards.</p>
                            <input type="number" class="stake-input" id="checkersStake" placeholder="Enter stake (min 0.01 CORE)" min="0.01" step="0.01">
                            <button class="create-game-btn" onclick="createCheckersGame()">
                                <i class="fas fa-th game-icon"></i> Create Checkers Game
                            </button>
                        </div>

                        <div class="game-card" id="wordCard">
                            <h3>📝 Word Battle</h3>
                            <p>Compete in word games with crypto stakes! Test your vocabulary.</p>
                            <input type="number" class="stake-input" id="wordStake" placeholder="Enter stake (min 0.01 CORE)" min="0.01" step="0.01">
                            <button class="create-game-btn" onclick="createWordGame()">📝 Create Word Game</button>
                        </div>

                        <div class="game-card" style="opacity: 0.3; position: relative;">
                            <h3>⚔️ Crypto Kombat</h3>
                            <p>Epic fighting game with NFT characters! Stake tokens and battle for supremacy.</p>
                            <input type="number" class="stake-input" placeholder="Enter stake (min 0.01 CORE)" disabled>
                            <button class="create-game-btn" disabled>Coming Soon</button>
                            <div style="position: absolute; top: 10px; right: 10px; background: linear-gradient(45deg, #ff6b6b, #ee5a52); color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.7rem; font-weight: bold;">COMING SOON</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Section -->
            <div id="chatSection" class="hidden">
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 1.5rem; height: 500px; display: flex; flex-direction: column;">
                    <h3 style="margin-bottom: 1rem;">💬 Global Chat</h3>
                    <div style="flex: 1; overflow-y: auto; margin-bottom: 1rem; padding: 1rem; background: rgba(0, 0, 0, 0.2); border-radius: 8px;" id="chatMessages">
                        <div style="margin-bottom: 0.8rem; padding: 0.5rem; border-radius: 8px; background: rgba(255, 255, 255, 0.05);">
                            <strong>CryptoKing:</strong> Just won 2.5 CORE in Chess! 🎉
                        </div>
                        <div style="margin-bottom: 0.8rem; padding: 0.5rem; border-radius: 8px; background: rgba(255, 255, 255, 0.05);">
                            <strong>GameMaster:</strong> New high stakes game starting soon!
                        </div>
                        <div style="margin-bottom: 0.8rem; padding: 0.5rem; border-radius: 8px; background: rgba(255, 255, 255, 0.05);">
                            <strong>BlockchainBro:</strong> Anyone up for Word Battle?
                        </div>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" style="flex: 1; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; padding: 0.8rem; color: white;" placeholder="Type your message..." id="chatInput" onkeypress="handleChatKeyPress(event)">
                        <button style="background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none; padding: 0.8rem 1.5rem; border-radius: 8px; color: white; font-weight: bold; cursor: pointer;" onclick="sendChatMessage()">Send</button>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profileSection" class="hidden">
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 1.5rem; margin-bottom: 2rem;">
                    <h3 style="color: #4ecdc4; margin-bottom: 1rem;">👤 Player Profile</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 8px; text-align: center;">
                            <h4 style="margin-bottom: 0.5rem; color: #aaa;">Games Played</h4>
                            <p style="font-size: 2rem; font-weight: bold; color: #4ecdc4;" id="profileGamesPlayed">0</p>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 8px; text-align: center;">
                            <h4 style="margin-bottom: 0.5rem; color: #aaa;">Games Won</h4>
                            <p style="font-size: 2rem; font-weight: bold; color: #00ff88;" id="profileGamesWon">0</p>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 8px; text-align: center;">
                            <h4 style="margin-bottom: 0.5rem; color: #aaa;">Total Earned</h4>
                            <p style="font-size: 2rem; font-weight: bold; color: #ffd700;" id="profileTotalEarned">0 CORE</p>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 8px; text-align: center;">
                            <h4 style="margin-bottom: 0.5rem; color: #aaa;">Win Rate</h4>
                            <p style="font-size: 2rem; font-weight: bold; color: #ff6b6b;" id="profileWinRate">0%</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other Sections (Leaderboard, News, Settings) -->
            <div id="leaderboardSection" class="hidden">
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 1.5rem;">
                    <h3 style="color: #ffd700; margin-bottom: 1rem;">🏆 Top Players This Week</h3>
                    <div id="leaderboardList">
                        <!-- Leaderboard entries will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <div id="newsSection" class="hidden">
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 1.5rem;">
                    <h3 style="color: #4ecdc4; margin-bottom: 1rem;">📰 Crypto Breaking News</h3>
                    <div id="newsContent">
                        <!-- News content will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <div id="settingsSection" class="hidden">
                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">⚙️ Platform Settings</h3>
                    <div id="settingsContent">
                        <!-- Settings content will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Game Windows -->
    
    <!-- Chess Game Window -->
    <div class="game-window hidden" id="chessGameWindow">
        <div class="game-window-header">
            <div class="game-window-title">♟️ Chess Masters</div>
            <div class="game-window-controls">
                <button class="window-btn minimize-btn" onclick="minimizeGame('chess')">−</button>
                <button class="window-btn close-btn" onclick="closeGame('chess')">×</button>
            </div>
        </div>
        <div class="game-window-content">
            <div style="text-align: center; font-size: 1.1rem; margin-bottom: 1rem; color: #4ecdc4;" id="chessStatus">Waiting for opponent...</div>
            <div class="chess-board" id="chessBoard"></div>
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem;">
                <button style="background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none; padding: 0.5rem 1rem; border-radius: 5px; color: white; cursor: pointer; transition: all 0.3s ease;" onclick="resignChess()">Resign</button>
                <button style="background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none; padding: 0.5rem 1rem; border-radius: 5px; color: white; cursor: pointer; transition: all 0.3s ease;" onclick="drawChess()">Offer Draw</button>
            </div>
            <!-- In-Game Chat -->
            <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 1rem; margin-top: 1rem; max-height: 200px; display: flex; flex-direction: column;">
                <h4 style="margin-bottom: 0.5rem; color: #4ecdc4;">Game Chat</h4>
                <div style="flex: 1; overflow-y: auto; margin-bottom: 0.5rem; max-height: 120px; background: rgba(0, 0, 0, 0.2); padding: 0.5rem; border-radius: 5px;" id="chessGameChat">
                    <div style="margin-bottom: 0.3rem; font-size: 0.9rem;"><strong>System:</strong> Game started!</div>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" style="flex: 1; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 5px; padding: 0.5rem; color: white;" placeholder="Type a message..." id="chessChatInput" onkeypress="handleGameChatKeyPress(event, 'chess')">
                    <button style="background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none; padding: 0.5rem 1rem; border-radius: 5px; color: white; cursor: pointer;" onclick="sendGameChatMessage('chess')">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkers Game Window -->
    <div class="game-window hidden" id="checkersGameWindow">
        <div class="game-window-header">
            <div class="game-window-title">⚫ Checkers Pro</div>
            <div class="game-window-controls">
                <button class="window-btn minimize-btn" onclick="minimizeGame('checkers')">−</button>
                <button class="window-btn close-btn" onclick="closeGame('checkers')">×</button>
            </div>
        </div>
        <div class="game-window-content">
            <div style="text-align: center; font-size: 1.1rem; margin-bottom: 1rem; color: #4ecdc4;" id="checkersStatus">Waiting for opponent...</div>
            <div class="checkers-board" id="checkersBoard"></div>
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem;">
                <button style="background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none; padding: 0.5rem 1rem; border-radius: 5px; color: white; cursor: pointer; transition: all 0.3s ease;" onclick="resignCheckers()">Resign</button>
            </div>
            <!-- In-Game Chat -->
            <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 1rem; margin-top: 1rem; max-height: 200px; display: flex; flex-direction: column;">
                <h4 style="margin-bottom: 0.5rem; color: #4ecdc4;">Game Chat</h4>
                <div style="flex: 1; overflow-y: auto; margin-bottom: 0.5rem; max-height: 120px; background: rgba(0, 0, 0, 0.2); padding: 0.5rem; border-radius: 5px;" id="checkersGameChat">
                    <div style="margin-bottom: 0.3rem; font-size: 0.9rem;"><strong>System:</strong> Game started!</div>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" style="flex: 1; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 5px; padding: 0.5rem; color: white;" placeholder="Type a message..." id="checkersChatInput" onkeypress="handleGameChatKeyPress(event, 'checkers')">
                    <button style="background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none; padding: 0.5rem 1rem; border-radius: 5px; color: white; cursor: pointer;" onclick="sendGameChatMessage('checkers')">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Word Game Window -->
    <div class="game-window hidden" id="wordGameWindow">
        <div class="game-window-header">
            <div class="game-window-title">📝 Word Battle</div>
            <div class="game-window-controls">
                <button class="window-btn minimize-btn" onclick="minimizeGame('word')">−</button>
                <button class="window-btn close-btn" onclick="closeGame('word')">×</button>
            </div>
        </div>
        <div class="game-window-content">
            <div style="text-align: center; font-size: 1.1rem; margin-bottom: 1rem; color: #4ecdc4;" id="wordStatus">Round 1 of 3</div>
            <div style="max-width: 500px; margin: 1rem auto; text-align: center;">
                <h4 id="wordPrompt">Make a word with these letters:</h4>
                <div id="wordLetters" style="font-size: 2rem; color: #4ecdc4; margin: 1rem 0; font-weight: bold;">BLOCKCHAIN</div>
                <input type="text" style="width: 100%; padding: 12px; font-size: 1.2rem; border: 2px solid #4ecdc4; border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: white; text-align: center; margin: 1rem 0;" id="wordInput" placeholder="Enter your word..." maxlength="20">
                <div style="display: flex; justify-content: space-between; background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                    <div style="font-size: 1.2rem;">Your Score: <span id="playerScore">0</span></div>
                    <div style="font-size: 1.2rem;">Opponent: <span id="opponentScore">0</span></div>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem;">
                    <button style="background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none; padding: 0.5rem 1rem; border-radius: 5px; color: white; cursor: pointer; transition: all 0.3s ease;" onclick="submitWord()">Submit Word</button>
                    <button style="background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none; padding: 0.5rem 1rem; border-radius: 5px; color: white; cursor: pointer; transition: all 0.3s ease;" onclick="skipRound()">Skip Round</button>
                </div>
            </div>
            <!-- In-Game Chat -->
            <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 1rem; margin-top: 1rem; max-height: 200px; display: flex; flex-direction: column;">
                <h4 style="margin-bottom: 0.5rem; color: #4ecdc4;">Game Chat</h4>
                <div style="flex: 1; overflow-y: auto; margin-bottom: 0.5rem; max-height: 120px; background: rgba(0, 0, 0, 0.2); padding: 0.5rem; border-radius: 5px;" id="wordGameChat">
                    <div style="margin-bottom: 0.3rem; font-size: 0.9rem;"><strong>System:</strong> Game started!</div>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" style="flex: 1; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 5px; padding: 0.5rem; color: white;" placeholder="Type a message..." id="wordChatInput" onkeypress="handleGameChatKeyPress(event, 'word')">
                    <button style="background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none; padding: 0.5rem 1rem; border-radius: 5px; color: white; cursor: pointer;" onclick="sendGameChatMessage('word')">Send</button>
                </div>
            </div>
        </div>
    </div>
    <script>
// FIXED BLOCKCHAIN INTEGRATION WITH ERROR HANDLING

const CONTRACT_ADDRESS = "0x7af2cB8f93D0a75E0ba39E974B4e968EAe49028A";
const CORE_CHAIN_ID = "0x45c"; // Core Mainnet Chain ID (1116 in decimal)

// Global Variables
let web3Provider = null;
let userAccount = null;
let gameContract = null;
let currentBalance = 0;
let isConnecting = false;
let activeGames = [];

// Simplified Contract ABI - Update this based on your actual contract
const CONTRACT_ABI = [
    "function createGame(uint256 gameType) external payable returns (uint256)",
    "function joinGame(uint256 gameId) external payable",
    "function getGameState(uint256 gameId) external view returns (uint8, address, address, uint256)"
];

// Enhanced Web3 initialization
async function initializeWeb3() {
    try {
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        if (typeof window.ethereum !== 'undefined') {
            web3Provider = new ethers.providers.Web3Provider(window.ethereum);
            
            const network = await web3Provider.getNetwork();
            console.log('Current network:', network);
            
            if (network.chainId !== parseInt(CORE_CHAIN_ID, 16)) {
                const switched = await switchToCore();
                if (!switched) {
                    throw new Error('Please switch to Core network manually');
                }
            }
            
            return true;
        } else {
            if (isMobile) {
                showTransactionStatus('❌ Please open in MetaMask browser or install MetaMask mobile app', '');
                setTimeout(() => {
                    window.location.href = `https://metamask.app.link/dapp/${window.location.host}`;
                }, 3000);
            } else {
                showTransactionStatus('❌ MetaMask not detected. Please install MetaMask extension.', '');
            }
            return false;
        }
    } catch (error) {
        console.error('Web3 initialization error:', error);
        showTransactionStatus('❌ Failed to initialize Web3: ' + error.message, '');
        return false;
    }
}

// Enhanced network switching
async function switchToCore() {
    try {
        await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: CORE_CHAIN_ID }],
        });
        return true;
    } catch (switchError) {
        console.log('Switch error:', switchError);
        
        if (switchError.code === 4902 || switchError.code === -32602) {
            try {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                        chainId: CORE_CHAIN_ID,
                        chainName: 'Core Blockchain Mainnet',
                        nativeCurrency: {
                            name: 'CORE',
                            symbol: 'CORE',
                            decimals: 18
                        },
                        rpcUrls: ['https://rpc.coredao.org', 'https://rpc-core.icecreamswap.com'],
                        blockExplorerUrls: ['https://scan.coredao.org']
                    }],
                });
                return true;
            } catch (addError) {
                console.error('Add network error:', addError);
                showTransactionStatus('❌ Failed to add Core network. Please add manually.', '');
                return false;
            }
        } else if (switchError.code === 4001) {
            showTransactionStatus('❌ User rejected network switch', '');
            return false;
        } else {
            showTransactionStatus('❌ Failed to switch network: ' + switchError.message, '');
            return false;
        }
    }
}

// Enhanced wallet connection
async function connectWallet() {
    if (isConnecting) {
        showTransactionStatus('⏳ Connection already in progress...', '');
        return;
    }
    
    isConnecting = true;
    
    try {
        showTransactionStatus('🔄 Connecting wallet...', '');
        
        if (!await initializeWeb3()) {
            isConnecting = false;
            return;
        }

        const accounts = await window.ethereum.request({
            method: 'eth_requestAccounts'
        });
        
        if (!accounts || accounts.length === 0) {
            throw new Error('No accounts found. Please unlock MetaMask.');
        }

        userAccount = accounts[0];
        
        // Get balance with retry logic
        let balance;
        let retries = 3;
        while (retries > 0) {
            try {
                balance = await web3Provider.getBalance(userAccount);
                break;
            } catch (balanceError) {
                retries--;
                if (retries === 0) throw balanceError;
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }
        
        currentBalance = parseFloat(ethers.utils.formatEther(balance));
        
        // Initialize contract with signer
        const signer = web3Provider.getSigner();
        gameContract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
        
        // Update UI
        updateWalletUI(true);
        
        showTransactionStatus('✅ Wallet connected successfully!', '');
        
        // Load active games
        await loadActiveGames();
        
        // Set up event listeners
        setupEventListeners();
        
    } catch (error) {
        console.error('Wallet connection error:', error);
        handleConnectionError(error);
    } finally {
        isConnecting = false;
    }
}

// Enhanced error handling
function handleConnectionError(error) {
    let errorMessage = 'Unknown error occurred';
    
    if (error.code === 4001) {
        errorMessage = 'Connection rejected by user';
    } else if (error.code === -32002) {
        errorMessage = 'Connection request pending. Check MetaMask.';
    } else if (error.message.includes('network')) {
        errorMessage = 'Network connection issue. Please check your internet.';
    } else if (error.message.includes('accounts')) {
        errorMessage = 'No accounts found. Please unlock MetaMask.';
    } else {
        errorMessage = error.message || 'Failed to connect wallet';
    }
    
    showTransactionStatus('❌ ' + errorMessage, '');
}

// Update wallet UI
function updateWalletUI(connected) {
    if (connected) {
        document.getElementById('connectionStatus').innerHTML = '🟢 Connected';
        document.getElementById('balanceDisplay').textContent = currentBalance.toFixed(4) + ' CORE';
        document.getElementById('connectBtn').classList.add('hidden');
        document.getElementById('disconnectBtn').classList.remove('hidden');
    } else {
        document.getElementById('connectionStatus').innerHTML = '🔴 Not Connected';
        document.getElementById('balanceDisplay').textContent = '0.00 CORE';
        document.getElementById('connectBtn').classList.remove('hidden');
        document.getElementById('disconnectBtn').classList.add('hidden');
    }
}

// Enhanced game creation with better error handling
async function createGameOnChain(gameType, stakeAmount) {
    if (!gameContract || !userAccount) {
        throw new Error('Wallet not connected');
    }
    
    if (stakeAmount > currentBalance) {
        throw new Error('Insufficient CORE balance');
    }
    
    try {
        const stakeWei = ethers.utils.parseEther(stakeAmount.toString());
        
        showTransactionStatus('🔄 Creating game on blockchain...', '');
        
        // Estimate gas first
        let gasEstimate;
        try {
            gasEstimate = await gameContract.estimateGas.createGame(gameType, { 
                value: stakeWei,
                from: userAccount
            });
            gasEstimate = gasEstimate.mul(120).div(100); // Add 20% buffer
        } catch (gasError) {
            console.warn('Gas estimation failed, using default:', gasError);
            gasEstimate = ethers.BigNumber.from('300000');
        }
        
        const gasPrice = await web3Provider.getGasPrice();
        
        const tx = await gameContract.createGame(gameType, { 
            value: stakeWei,
            gasLimit: gasEstimate,
            gasPrice: gasPrice
        });
        
        showTransactionStatus('⏳ Transaction submitted. Waiting for confirmation...', tx.hash);
        
        const receipt = await tx.wait(1);
        
        showTransactionStatus('✅ Game created successfully!', tx.hash);
        
        // Update balance
        const newBalance = await web3Provider.getBalance(userAccount);
        currentBalance = parseFloat(ethers.utils.formatEther(newBalance));
        updateWalletUI(true);
        
        // Extract game ID from receipt
        let gameId = Date.now(); // Fallback to timestamp
        if (receipt.logs && receipt.logs.length > 0) {
            try {
                gameId = parseInt(receipt.logs[0].topics[1], 16);
            } catch (parseError) {
                console.warn('Could not parse game ID from logs');
            }
        }
        
        return gameId;
        
    } catch (error) {
        console.error('Game creation error:', error);
        
        if (error.code === 4001) {
            throw new Error('Transaction rejected by user');
        } else if (error.code === -32603) {
            throw new Error('Transaction failed. Please check your balance and try again.');
        } else if (error.message.includes('insufficient funds')) {
            throw new Error('Insufficient CORE for transaction fees');
        } else if (error.message.includes('gas')) {
            throw new Error('Transaction failed due to gas issues. Please try again.');
        } else {
            throw new Error(error.reason || error.message || 'Transaction failed');
        }
    }
}

// Setup event listeners
function setupEventListeners() {
    if (!window.ethereum) return;
    
    window.ethereum.on('accountsChanged', handleAccountsChanged);
    window.ethereum.on('chainChanged', handleChainChanged);
    window.ethereum.on('disconnect', handleDisconnect);
}

// Handle account changes
function handleAccountsChanged(accounts) {
    if (accounts.length === 0) {
        disconnectWallet();
    } else if (accounts[0] !== userAccount) {
        userAccount = accounts[0];
        connectWallet();
    }
}

// Handle chain changes
function handleChainChanged(chainId) {
    if (chainId !== CORE_CHAIN_ID) {
        showTransactionStatus('⚠️ Please switch to Core network', '');
        disconnectWallet();
    } else {
        if (userAccount) {
            connectWallet();
        }
    }
}

// Handle disconnect
function handleDisconnect(error) {
    console.log('Wallet disconnected:', error);
    disconnectWallet();
}

// Disconnect wallet
function disconnectWallet() {
    userAccount = null;
    currentBalance = 0;
    gameContract = null;
    
    updateWalletUI(false);
    showTransactionStatus('👋 Wallet disconnected', '');
}

// Load active games
async function loadActiveGames() {
    try {
        activeGames = [];
        updateActiveGamesDisplay();
        updateGameStats();
    } catch (error) {
        console.error('Failed to load active games:', error);
    }
}

// Event listeners
document.getElementById('connectBtn').addEventListener('click', connectWallet);
document.getElementById('disconnectBtn').addEventListener('click', disconnectWallet);

// Auto-connect if previously connected
document.addEventListener('DOMContentLoaded', async () => {
    if (localStorage.getItem('walletConnected') === 'true') {
        setTimeout(connectWallet, 1000);
    }
});

// Store connection state
window.addEventListener('beforeunload', () => {
    if (userAccount) {
        localStorage.setItem('walletConnected', 'true');
    } else {
        localStorage.removeItem('walletConnected');
    }
});
</script>
<script>
// GAME LOGIC & MANAGEMENT

let currentSection = 'games';
let openWindows = [];
let windowZIndex = 1000;
let playerStats = {
    gamesPlayed: 0,
    gamesWon: 0,
    totalEarned: 0,
    chess: { wins: 0, losses: 0 },
    checkers: { wins: 0, losses: 0 },
    words: { wins: 0, losses: 0 }
};

// Game States
let chessGameState = {
    gameId: null,
    board: null,
    turn: 'white',
    selectedPiece: null,
    possibleMoves: [],
    gameOver: false,
    myColor: 'white',
    opponentAddress: null
};

let checkersGameState = {
    gameId: null,
    board: null,
    turn: 'red',
    selectedPiece: null,
    possibleMoves: [],
    gameOver: false,
    myColor: 'red',
    opponentAddress: null
};

// Chess piece symbols
const CHESS_SYMBOLS = {
    'K': '♔', 'Q': '♕', 'R': '♖', 'B': '♗', 'N': '♘', 'P': '♙',
    'k': '♚', 'q': '♛', 'r': '♜', 'b': '♝', 'n': '♞', 'p': '♟'
};

// Navigation functions
function showSection(section) {
    document.querySelectorAll('[id$="Section"]').forEach(el => el.classList.add('hidden'));
    document.getElementById(section + 'Section').classList.remove('hidden');
    
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.target.classList.add('active');
    
    currentSection = section;
    document.getElementById('navMenu').classList.remove('active');
    
    if (section === 'profile') updateProfileDisplay();
}

function toggleMobileMenu() {
    const navMenu = document.getElementById('navMenu');
    navMenu.classList.toggle('active');
}

// Game Creation Functions
async function createChessGame() {
    const stakeAmount = parseFloat(document.getElementById('chessStake').value);
    if (!validateStakeAndWallet(stakeAmount)) return;
    
    try {
        showTransactionStatus('🔄 Creating Chess game...', '');
        
        const gameId = await createGameOnChain(0, stakeAmount); // 0 = Chess
        
        const newGame = {
            id: gameId,
            type: 'chess',
            creator: userAccount,
            stake: stakeAmount,
            status: 'waiting',
            timestamp: Date.now()
        };
        
        activeGames.push(newGame);
        updateActiveGamesDisplay();
        
        chessGameState.gameId = gameId;
        chessGameState.myColor = 'white';
        openGameWindow('chess');
        initializeChessBoard();
        
        document.getElementById('chessStatus').textContent = 'Waiting for opponent...';
        playerStats.gamesPlayed++;
        updateProfileDisplay();
        
        document.getElementById('chessStake').value = '';
        
    } catch (error) {
        showTransactionStatus('❌ Failed to create Chess game: ' + error.message, '');
    }
}

async function createCheckersGame() {
    const stakeAmount = parseFloat(document.getElementById('checkersStake').value);
    if (!validateStakeAndWallet(stakeAmount)) return;
    
    try {
        showTransactionStatus('🔄 Creating Checkers game...', '');
        
        const gameId = await createGameOnChain(1, stakeAmount); // 1 = Checkers
        
        const newGame = {
            id: gameId,
            type: 'checkers',
            creator: userAccount,
            stake: stakeAmount,
            status: 'waiting',
            timestamp: Date.now()
        };
        
        activeGames.push(newGame);
        updateActiveGamesDisplay();
        
        checkersGameState.gameId = gameId;
        checkersGameState.myColor = 'red';
        openGameWindow('checkers');
        initializeCheckersBoard();
        
        document.getElementById('checkersStatus').textContent = 'Waiting for opponent...';
        playerStats.gamesPlayed++;
        updateProfileDisplay();
        
        document.getElementById('checkersStake').value = '';
        
    } catch (error) {
        showTransactionStatus('❌ Failed to create Checkers game: ' + error.message, '');
    }
}

async function createWordGame() {
    const stakeAmount = parseFloat(document.getElementById('wordStake').value);
    if (!validateStakeAndWallet(stakeAmount)) return;
    
    try {
        showTransactionStatus('🔄 Creating Word game...', '');
        
        const gameId = await createGameOnChain(2, stakeAmount); // 2 = Word Battle
        
        const newGame = {
            id: gameId,
            type: 'words',
            creator: userAccount,
            stake: stakeAmount,
            status: 'waiting',
            timestamp: Date.now()
        };
        
        activeGames.push(newGame);
        updateActiveGamesDisplay();
        
        openGameWindow('word');
        startWordGame();
        
        playerStats.gamesPlayed++;
        updateProfileDisplay();
        
        document.getElementById('wordStake').value = '';
        
    } catch (error) {
        showTransactionStatus('❌ Failed to create Word game: ' + error.message, '');
    }
}

// Validation function
function validateStakeAndWallet(stakeAmount) {
    if (!userAccount) {
        showTransactionStatus('❌ Please connect your wallet first', '');
        return false;
    }
    
    if (!stakeAmount || stakeAmount < 0.01) {
        showTransactionStatus('❌ Please enter a valid stake amount (minimum 0.01 CORE)', '');
        return false;
    }
    
    if (stakeAmount > currentBalance) {
        showTransactionStatus('❌ Insufficient CORE balance', '');
        return false;
    }
    
    return true;
}

// Game joining function
async function joinGame(gameType, gameId, stakeAmount) {
    if (!userAccount) {
        showTransactionStatus('❌ Please connect your wallet first', '');
        return;
    }
    
    if (currentBalance < stakeAmount) {
        showTransactionStatus('❌ Insufficient CORE balance', '');
        return;
    }
    
    try {
        showTransactionStatus('🔄 Joining game...', '');
        
        await joinGameOnChain(gameId, stakeAmount);
        
        activeGames = activeGames.filter(game => game.id !== gameId);
        updateActiveGamesDisplay();
        
        if (gameType === 'chess') {
            chessGameState.gameId = gameId;
            chessGameState.myColor = 'black';
            openGameWindow('chess');
            initializeChessBoard();
            document.getElementById('chessStatus').textContent = 'Game started! Waiting for white to move...';
        } else if (gameType === 'checkers') {
            checkersGameState.gameId = gameId;
            checkersGameState.myColor = 'black';
            openGameWindow('checkers');
            initializeCheckersBoard();
            document.getElementById('checkersStatus').textContent = 'Game started! Waiting for red to move...';
        } else if (gameType === 'words') {
            openGameWindow('word');
            startWordGame();
        }
        
        playerStats.gamesPlayed++;
        updateProfileDisplay();
        
    } catch (error) {
        showTransactionStatus('❌ Failed to join game: ' + error.message, '');
    }
}

// Update active games display
function updateActiveGamesDisplay() {
    const gamesList = document.getElementById('activeGamesList');
    const noGamesDiv = document.getElementById('noActiveGames');
    
    gamesList.innerHTML = '';
    
    if (activeGames.length === 0) {
        gamesList.appendChild(noGamesDiv);
        noGamesDiv.classList.remove('hidden');
        updateGameStats();
        return;
    }
    
    noGamesDiv.classList.add('hidden');
    
    activeGames.forEach(game => {
        const gameDiv = document.createElement('div');
        gameDiv.className = 'game-lobby-item';
        
        const gameIcon = game.type === 'chess' ? '♟️' : 
                        game.type === 'checkers' ? '⚫' : '📝';
        const gameName = game.type === 'chess' ? 'Chess Masters' : 
                       game.type === 'checkers' ? 'Checkers Pro' : 'Word Battle';
        
        const timeAgo = Math.floor((Date.now() - game.timestamp) / 60000);
        const creator = game.creator === userAccount ? 'You' : 
                       game.creator.substring(0, 6) + '...' + game.creator.substring(38);
        
        gameDiv.innerHTML = `
            <div>
                <strong>${gameIcon} ${gameName}</strong>
                <div style="font-size: 0.9rem; color: #aaa;">
                    ${creator} • Stake: ${game.stake} CORE • ${timeAgo}m ago
                </div>
            </div>
            ${game.creator !== userAccount ? 
                `<button class="join-game-btn" onclick="joinGame('${game.type}', ${game.id}, ${game.stake})">
                    Join Game
                </button>` : 
                `<span style="color: #ffd700; font-weight: bold;">Your Game</span>`
            }
        `;
        
        gamesList.appendChild(gameDiv);
    });
    
    updateGameStats();
}

// Game Window Management
function openGameWindow(gameType) {
    const gameWindow = document.getElementById(gameType + 'GameWindow');
    const overlay = document.getElementById('gameOverlay');
    
    windowZIndex += 10;
    gameWindow.style.zIndex = windowZIndex;
    
    if (!openWindows.includes(gameType)) {
        openWindows.push(gameType);
    }
    
    gameWindow.classList.remove('hidden', 'minimized');
    overlay.classList.remove('hidden');
    
    overlay.onclick = () => {
        if (openWindows.length === 1) {
            overlay.classList.add('hidden');
        }
    };
    
    gameWindow.onclick = (e) => {
        if (gameWindow.classList.contains('minimized')) {
            restoreGame(gameType);
            e.stopPropagation();
        } else {
            windowZIndex += 10;
            gameWindow.style.zIndex = windowZIndex;
        }
    };
}

function minimizeGame(gameType) {
    const gameWindow = document.getElementById(gameType + 'GameWindow');
    gameWindow.classList.add('minimized');
    
    const hasOpenWindows = openWindows.some(type => 
        !document.getElementById(type + 'GameWindow').classList.contains('minimized')
    );
    
    if (!hasOpenWindows) {
        document.getElementById('gameOverlay').classList.add('hidden');
    }
}

function restoreGame(gameType) {
    const gameWindow = document.getElementById(gameType + 'GameWindow');
    gameWindow.classList.remove('minimized');
    document.getElementById('gameOverlay').classList.remove('hidden');
}

function closeGame(gameType) {
    if (confirm('Are you sure you want to close this game? This may forfeit the match.')) {
        const gameWindow = document.getElementById(gameType + 'GameWindow');
        gameWindow.classList.add('hidden');
        
        openWindows = openWindows.filter(window => window !== gameType);
        if (openWindows.length === 0) {
            document.getElementById('gameOverlay').classList.add('hidden');
        }
        
        // Reset game state
        if (gameType === 'chess') {
            if (chessGameState.gameId && !chessGameState.gameOver) {
                playerStats.chess.losses++;
            }
            resetChessGame();
        } else if (gameType === 'checkers') {
            if (checkersGameState.gameId && !checkersGameState.gameOver) {
                playerStats.checkers.losses++;
            }
            resetCheckersGame();
        }
        
        updateProfileDisplay();
        showTransactionStatus('Game closed', '');
    }
}

// Reset game states
function resetChessGame() {
    chessGameState = {
        gameId: null,
        board: null,
        turn: 'white',
        selectedPiece: null,
        possibleMoves: [],
        gameOver: false,
        myColor: 'white',
        opponentAddress: null
    };
}

function resetCheckersGame() {
    checkersGameState = {
        gameId: null,
        board: null,
        turn: 'red',
        selectedPiece: null,
        possibleMoves: [],
        gameOver: false,
        myColor: 'red',
        opponentAddress: null
    };
}

// Transaction status display
function showTransactionStatus(message, txHash = '') {
    const statusDiv = document.getElementById('transactionStatus');
    const messageDiv = document.getElementById('txStatusMessage');
    const hashDiv = document.getElementById('txHash');
    
    messageDiv.textContent = message;
    hashDiv.textContent = txHash ? `TX: ${txHash.substring(0, 10)}...${txHash.substring(56)}` : '';
    hashDiv.onclick = txHash ? () => window.open(`https://scan.coredao.org/tx/${txHash}`, '_blank') : null;
    hashDiv.style.cursor = txHash ? 'pointer' : 'default';
    
    statusDiv.classList.add('show');
    
    setTimeout(() => statusDiv.classList.remove('show'), 5000);
}

// Profile update
function updateProfileDisplay() {
    document.getElementById('profileGamesPlayed').textContent = playerStats.gamesPlayed;
    document.getElementById('profileGamesWon').textContent = playerStats.gamesWon;
    document.getElementById('profileTotalEarned').textContent = playerStats.totalEarned.toFixed(4) + ' CORE';
    
    const winRate = playerStats.gamesPlayed > 0 ?
        ((playerStats.gamesWon / playerStats.gamesPlayed) * 100).toFixed(1) : 0;
    document.getElementById('profileWinRate').textContent = winRate + '%';
}

// Update game statistics
function updateGameStats() {
    const activeCount = activeGames.length;
    const totalPool = activeGames.reduce((sum, game) => sum + game.stake, 0);
    
    document.getElementById('activeGameCount').textContent = activeCount;
    document.getElementById('totalPool').textContent = totalPool.toFixed(2) + ' CORE';
    
    const winners = ['CryptoKing', 'GameMaster', 'BlockchainBro', 'TokenMaster', 'WordWizard'];
    document.getElementById('lastWinner').textContent = winners[Math.floor(Math.random() * winners.length)];
}

// Age verification
function verifyAge(isAdult) {
    if (isAdult) {
        document.getElementById('ageVerificationModal').style.display = 'none';
        sessionStorage.setItem('ageVerified', 'true');
        showTransactionStatus('✅ Age verified. Welcome to Crypticus!');
    } else {
        alert('Sorry, you must be 18 or older to use this platform.');
        window.location.href = 'https://www.google.com';
    }
}

function checkAgeVerification() {
    if (!sessionStorage.getItem('ageVerified')) {
        document.getElementById('ageVerificationModal').style.display = 'flex';
    }
}
</script>
<script>
// CHESS GAME IMPLEMENTATION
function initializeChessBoard() {
    chessGameState.board = [
        ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
        ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
        [null, null, null, null, null, null, null, null],
        [null, null, null, null, null, null, null, null],
        [null, null, null, null, null, null, null, null],
        [null, null, null, null, null, null, null, null],
        ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
        ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
    ];
    
    chessGameState.turn = 'white';
    chessGameState.selectedPiece = null;
    chessGameState.possibleMoves = [];
    chessGameState.gameOver = false;
    
    renderChessBoard();
}

function renderChessBoard() {
    const boardElement = document.getElementById('chessBoard');
    boardElement.innerHTML = '';
    
    for (let row = 0; row < 8; row++) {
        for (let col = 0; col < 8; col++) {
            const square = document.createElement('div');
            square.className = `chess-square ${(row + col) % 2 === 0 ? 'white' : 'black'}`;
            square.dataset.row = row;
            square.dataset.col = col;
            
            if (chessGameState.selectedPiece &&
                chessGameState.selectedPiece.row === row &&
                chessGameState.selectedPiece.col === col) {
                square.classList.add('selected');
            }
            
            if (chessGameState.possibleMoves.some(move => move.row === row && move.col === col)) {
                square.classList.add('possible-move');
            }
            
            square.onclick = () => handleChessClick(row, col);
            
            const piece = chessGameState.board[row][col];
            if (piece) {
                square.textContent = CHESS_SYMBOLS[piece] || '';
            }
            
            boardElement.appendChild(square);
        }
    }
    
    updateChessStatus();
}

function updateChessStatus() {
    const isMyTurn = (chessGameState.turn === 'white' && chessGameState.myColor === 'white') ||
                     (chessGameState.turn === 'black' && chessGameState.myColor === 'black');
    
    let status = '';
    if (chessGameState.gameOver) {
        status = 'Game Over';
    } else if (isMyTurn) {
        status = 'Your turn';
    } else {
        status = 'Opponent\'s turn';
    }
    
    document.getElementById('chessStatus').textContent = status;
}

function handleChessClick(row, col) {
    if (chessGameState.gameOver) return;
    
    const isMyTurn = (chessGameState.turn === 'white' && chessGameState.myColor === 'white') ||
                     (chessGameState.turn === 'black' && chessGameState.myColor === 'black');
    
    if (!isMyTurn) {
        showTransactionStatus('⚠️ Wait for your turn', '');
        return;
    }
    
    const piece = chessGameState.board[row][col];
    
    if (chessGameState.selectedPiece) {
        const move = chessGameState.possibleMoves.find(m => m.row === row && m.col === col);
        if (move) {
            makeChessMove(chessGameState.selectedPiece.row, chessGameState.selectedPiece.col, row, col);
            return;
        }
        
        if (piece && isPlayerPiece(piece, chessGameState.myColor)) {
            selectChessPiece(row, col);
            return;
        }
        
        chessGameState.selectedPiece = null;
        chessGameState.possibleMoves = [];
        renderChessBoard();
    }
    
    if (piece && isPlayerPiece(piece, chessGameState.myColor)) {
        selectChessPiece(row, col);
    }
}

function selectChessPiece(row, col) {
    chessGameState.selectedPiece = { row, col };
    chessGameState.possibleMoves = calculatePossibleMoves(row, col);
    renderChessBoard();
}

function calculatePossibleMoves(row, col) {
    // Simplified chess logic - basic piece movement
    const piece = chessGameState.board[row][col];
    if (!piece) return [];
    
    const moves = [];
    const color = piece === piece.toUpperCase() ? 'white' : 'black';
    
    // Basic movement for demo - you can expand this
    switch (piece.toLowerCase()) {
        case 'p': // Pawn
            const direction = color === 'white' ? -1 : 1;
            if (row + direction >= 0 && row + direction < 8 && !chessGameState.board[row + direction][col]) {
                moves.push({ row: row + direction, col });
            }
            break;
        case 'r': // Rook
            for (const [dr, dc] of [[1, 0], [-1, 0], [0, 1], [0, -1]]) {
                for (let i = 1; i < 8; i++) {
                    const newRow = row + dr * i;
                    const newCol = col + dc * i;
                    if (newRow < 0 || newRow > 7 || newCol < 0 || newCol > 7) break;
                    if (!chessGameState.board[newRow][newCol]) {
                        moves.push({ row: newRow, col: newCol });
                    } else {
                        break;
                    }
                }
            }
            break;
        // Add more pieces as needed
    }
    
    return moves;
}

function makeChessMove(fromRow, fromCol, toRow, toCol) {
    const piece = chessGameState.board[fromRow][fromCol];
    
    chessGameState.board[toRow][toCol] = piece;
    chessGameState.board[fromRow][fromCol] = null;
    
    chessGameState.turn = chessGameState.turn === 'white' ? 'black' : 'white';
    chessGameState.selectedPiece = null;
    chessGameState.possibleMoves = [];
    
    addGameChatMessage('chess', 'You', `Moved ${CHESS_SYMBOLS[piece]}`);
    renderChessBoard();
}

function isPlayerPiece(piece, color) {
    if (color === 'white') {
        return piece === piece.toUpperCase();
    } else {
        return piece === piece.toLowerCase();
    }
}

function resignChess() {
    if (confirm('Are you sure you want to resign?')) {
        chessGameState.gameOver = true;
        playerStats.chess.losses++;
        document.getElementById('chessStatus').textContent = 'You resigned';
        updateProfileDisplay();
        addGameChatMessage('chess', 'You', 'resigned from the game');
    }
}

function drawChess() {
    addGameChatMessage('chess', 'You', 'offered a draw');
    showTransactionStatus('Draw offer sent to opponent', '');
}

// CHECKERS GAME IMPLEMENTATION
function initializeCheckersBoard() {
    checkersGameState.board = Array(8).fill().map(() => Array(8).fill(null));
    
    for (let row = 0; row < 8; row++) {
        for (let col = 0; col < 8; col++) {
            if ((row + col) % 2 === 1) {
                if (row < 3) {
                    checkersGameState.board[row][col] = 'red';
                } else if (row > 4) {
                    checkersGameState.board[row][col] = 'black';
                }
            }
        }
    }
    
    checkersGameState.turn = 'red';
    checkersGameState.gameOver = false;
    renderCheckersBoard();
}

function renderCheckersBoard() {
    const boardElement = document.getElementById('checkersBoard');
    boardElement.innerHTML = '';
    
    for (let row = 0; row < 8; row++) {
        for (let col = 0; col < 8; col++) {
            const square = document.createElement('div');
            square.className = `checkers-square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
            square.onclick = () => handleCheckersClick(row, col);
            
            const piece = checkersGameState.board[row][col];
            if (piece) {
                const pieceDiv = document.createElement('div');
                pieceDiv.className = `checker-piece ${piece.toLowerCase()}-piece`;
                pieceDiv.style.width = '45px';
                pieceDiv.style.height = '45px';
                pieceDiv.style.borderRadius = '50%';
                pieceDiv.style.border = '2px solid #000';
                if (piece === 'red') {
                    pieceDiv.style.background = 'radial-gradient(circle, #ff4444, #cc0000)';
                } else {
                    pieceDiv.style.background = 'radial-gradient(circle, #444444, #000000)';
                }
                square.appendChild(pieceDiv);
            }
            
            boardElement.appendChild(square);
        }
    }
    
    updateCheckersStatus();
}

function updateCheckersStatus() {
    const isMyTurn = (checkersGameState.turn === 'red' && checkersGameState.myColor === 'red') ||
                     (checkersGameState.turn === 'black' && checkersGameState.myColor === 'black');
    
    let status = '';
    if (checkersGameState.gameOver) {
        status = 'Game Over';
    } else if (isMyTurn) {
        status = 'Your turn';
    } else {
        status = 'Opponent\'s turn';
    }
    
    document.getElementById('checkersStatus').textContent = status;
}

function handleCheckersClick(row, col) {
    if (checkersGameState.gameOver) return;
    
    const isMyTurn = (checkersGameState.turn === 'red' && checkersGameState.myColor === 'red') ||
                     (checkersGameState.turn === 'black' && checkersGameState.myColor === 'black');
    
    if (!isMyTurn) {
        showTransactionStatus('⚠️ Wait for your turn', '');
        return;
    }
    
    // Simplified checkers - just switch turns on any click
    checkersGameState.turn = checkersGameState.turn === 'red' ? 'black' : 'red';
    addGameChatMessage('checkers', 'You', 'Made a move');
    renderCheckersBoard();
}

function resignCheckers() {
    if (confirm('Are you sure you want to resign?')) {
        checkersGameState.gameOver = true;
        playerStats.checkers.losses++;
        document.getElementById('checkersStatus').textContent = 'You resigned';
        updateProfileDisplay();
        addGameChatMessage('checkers', 'You', 'resigned from the game');
    }
}

// WORD GAME IMPLEMENTATION
function startWordGame() {
    document.getElementById('wordStatus').textContent = 'Round 1 of 3';
    document.getElementById('wordLetters').textContent = 'BLOCKCHAIN';
    document.getElementById('playerScore').textContent = '0';
    document.getElementById('opponentScore').textContent = '0';
    addGameChatMessage('word', 'System', 'Word Battle started! Make words with the given letters.');
}

function submitWord() {
    const wordInput = document.getElementById('wordInput');
    const word = wordInput.value.trim().toUpperCase();
    
    if (!word) {
        showTransactionStatus('Please enter a word!', '');
        return;
    }
    
    if (word.length < 3) {
        showTransactionStatus('Word must be at least 3 letters!', '');
        return;
    }
    
    const score = word.length * 10;
    const currentScore = parseInt(document.getElementById('playerScore').textContent);
    document.getElementById('playerScore').textContent = currentScore + score;
    
    addGameChatMessage('word', 'You', `Submitted: ${word} (+${score} points)`);
    wordInput.value = '';
    
    showTransactionStatus(`✅ +${score} points for "${word}"`, '');
}

function skipRound() {
    addGameChatMessage('word', 'You', 'skipped this round');
    showTransactionStatus('Round skipped', '');
}

// CHAT SYSTEM
function sendChatMessage() {
    const chatInput = document.getElementById('chatInput');
    const message = chatInput.value.trim();
    
    if (!message) return;
    
    if (!userAccount) {
        showTransactionStatus('⚠️ Please connect your wallet to chat', '');
        return;
    }
    
    addChatMessage('You', message);
    chatInput.value = '';
    
    setTimeout(() => {
        const responses = [
            "Good luck in your games! 🎮",
            "Welcome to Crypticus! 🚀", 
            "Let's play some games! ⚔️",
            "Nice strategy! 🧠",
            "The blockchain gaming future is here! 💎"
        ];
        const randomUser = ['CryptoKing', 'GameMaster', 'BlockchainBro'][Math.floor(Math.random() * 3)];
        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
        addChatMessage(randomUser, randomResponse);
    }, 1000 + Math.random() * 3000);
}

function addChatMessage(user, message) {
    const chatMessages = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.style.cssText = 'margin-bottom: 0.8rem; padding: 0.5rem; border-radius: 8px; background: rgba(255, 255, 255, 0.05);';
    messageDiv.innerHTML = `<strong>${user}:</strong> ${message}`;
    
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    while (chatMessages.children.length > 50) {
        chatMessages.removeChild(chatMessages.firstChild);
    }
}

function handleChatKeyPress(event) {
    if (event.key === 'Enter') {
        sendChatMessage();
    }
}

// IN-GAME CHAT
function sendGameChatMessage(gameType) {
    const chatInput = document.getElementById(gameType + 'ChatInput');
    const message = chatInput.value.trim();
    
    if (!message) return;
    
    addGameChatMessage(gameType, 'You', message);
    chatInput.value = '';
    
    if (Math.random() < 0.3) {
        setTimeout(() => {
            const responses = ["Good move!", "Interesting strategy", "Let's see...", "Nice one!"];
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            addGameChatMessage(gameType, 'Opponent', randomResponse);
        }, 1000 + Math.random() * 2000);
    }
}

function addGameChatMessage(gameType, user, message) {
    const chatMessages = document.getElementById(gameType + 'GameChat');
    const messageDiv = document.createElement('div');
    messageDiv.style.cssText = 'margin-bottom: 0.3rem; font-size: 0.9rem;';
    messageDiv.innerHTML = `<strong>${user}:</strong> ${message}`;
    
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    while (chatMessages.children.length > 20) {
        chatMessages.removeChild(chatMessages.firstChild);
    }
}

function handleGameChatKeyPress(event, gameType) {
    if (event.key === 'Enter') {
        sendGameChatMessage(gameType);
    }
}

// INITIALIZATION
document.addEventListener('DOMContentLoaded', () => {
    console.log('🚀 Crypticus Platform Initialized');
    
    checkAgeVerification();
    updateActiveGamesDisplay();
    updateProfileDisplay();
    
    // Initialize sample chat messages
    addChatMessage('System', 'Welcome to Crypticus! Connect your wallet to start playing.');
    addChatMessage('CryptoKing', 'Just won 2.5 CORE in Chess! 🎉');
    addChatMessage('GameMaster', 'New high stakes games available!');
    
    // Auto-hide transaction status on click
    document.getElementById('transactionStatus').addEventListener('click', () => {
        document.getElementById('transactionStatus').classList.remove('show');
    });
    
    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
        const navMenu = document.getElementById('navMenu');
        const mobileBtn = document.querySelector('.mobile-menu-btn');
        
        if (!navMenu.contains(e.target) && e.target !== mobileBtn && 
            !mobileBtn.contains(e.target) && navMenu.classList.contains('active')) {
            navMenu.classList.remove('active');
        }
    });
    
    // Auto-update game stats
    setInterval(() => {
        updateGameStats();
    }, 30000);
});
</script>
</body>
</html>
