<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Crypticus - Live Blockchain Gaming Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4e54c8;
            --primary-dark: #363a9e;
            --secondary: #f39c12;
            --dark: #1a1c2c;
            --light: #f5f7fa;
            --danger: #e74c3c;
            --success: #2ecc71;
            --warning: #f1c40f;
            --gray: #95a5a6;
        }

        /* MOBILE & SCROLLING FIXES */
        html, body {
            height: 100%;
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }

        body {
            background: linear-gradient(135deg, #1a1c2c, #2c3e50);
            color: var(--light);
            min-height: 100vh;
            position: relative;
        }

        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://images.unsplash.com/photo-1620336655052-b57986f5a26a?q=80&w=1920') no-repeat center center;
            background-size: cover;
            opacity: 0.15;
            z-index: -1;
        }

        .background::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(26, 28, 44, 0.8), rgba(44, 62, 80, 0.8));
            z-index: 1;
        }

        .hidden {
            display: none;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #4ecdc4;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
      /* AGE VERIFICATION MODAL */
.age-verification {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    backdrop-filter: blur(10px);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

.verification-content {
    background: var(--dark);
    border-radius: 16px;
    padding: 20px;
    max-width: 90vw;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    border: 2px solid var(--primary);
    margin: 20px;
}

.verification-content h1 {
    font-size: 1.8rem;
    margin-bottom: 15px;
    color: var(--secondary);
}

.verification-content p {
    font-size: 1rem;
    margin-bottom: 20px;
    line-height: 1.6;
    color: var(--light);
}

.verification-content .warning {
    background: rgba(231, 76, 60, 0.2);
    border-left: 4px solid var(--danger);
    padding: 10px;
    margin: 15px 0;
    border-radius: 0 8px 8px 0;
    text-align: left;
    font-size: 0.9rem;
}

.verify-btn {
    display: block;
    width: 100%;
    margin: 0.5rem 0;
    padding: 1rem;
    font-size: 1rem;
    border: none;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.verify-btn.accept {
    background: linear-gradient(45deg, #4ecdc4, #44a08d);
    color: white;
}

.verify-btn.decline {
    background: linear-gradient(45deg, #ff6b6b, #ee5a52);
    color: white;
}

/* iOS Safari specific fixes */
@supports (-webkit-touch-callout: none) {
    .age-verification {
        height: 100vh;
        height: -webkit-fill-available;
    }
    
    .verification-content {
        max-height: 85vh;
        max-height: -webkit-fill-available;
    }
}
/* HEADER & NAVIGATION */
.header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 200;
    background: linear-gradient(135deg, rgba(26, 28, 44, 0.95), rgba(44, 62, 80, 0.95));
    backdrop-filter: blur(15px);
    padding: 0.8rem 1rem;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    min-height: 70px;
}

.logo {
    display: flex;
    align-items: center;
    gap: 10px;
}

.logo h1 {
    font-size: 1.8rem;
    background: linear-gradient(to right, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.logo-icon {
    font-size: 2.5rem;
    color: var(--secondary);
}

.nav-menu {
    display: flex;
    gap: 2rem;
    align-items: center;
}

.nav-item {
    padding: 0.5rem 1rem;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid transparent;
}

.nav-item:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(78, 205, 196, 0.5);
}

.nav-item.active {
    background: linear-gradient(45deg, #4ecdc4, #44a08d);
    color: white;
}

.live-badge {
    background: linear-gradient(45deg, #00ff88, #00cc6a);
    color: #000;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: bold;
    font-size: 0.8rem;
    animation: pulse 2s infinite;
}

.wallet-section {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.wallet-info {
    text-align: right;
}

.connection-status {
    font-size: 0.9rem;
    color: #ff6b6b;
}

.balance {
    font-size: 1.2rem;
    font-weight: bold;
}

.connect-btn, .disconnect-btn {
    background: linear-gradient(45deg, #4ecdc4, #44a08d);
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 25px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.disconnect-btn {
    background: linear-gradient(45deg, #ff6b6b, #ee5a52);
    margin-left: 0.5rem;
}

.connect-btn:hover, .disconnect-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(78, 205, 196, 0.3);
}

.mobile-menu-btn {
    display: none;
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0.5rem;
    margin-left: auto;
}

/* MOBILE NAVIGATION */
@media (max-width: 768px) {
    .header {
        padding: 0.5rem;
        min-height: 60px;
        flex-direction: row;
        flex-wrap: nowrap;
    }
    
    .logo h1 {
        font-size: 1.3rem;
    }
    
    .mobile-menu-btn {
        display: block;
        order: 2;
        z-index: 300;
    }
    
    .nav-menu {
        position: fixed;
        top: 60px;
        left: -100%;
        width: 100%;
        height: calc(100vh - 60px);
        background: rgba(0, 0, 0, 0.98);
        backdrop-filter: blur(15px);
        flex-direction: column;
        justify-content: flex-start;
        align-items: stretch;
        padding: 1rem;
        gap: 1rem;
        transition: left 0.3s ease;
        z-index: 150;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    .nav-menu.active {
        left: 0;
    }
    
    .nav-item {
        padding: 1rem;
        border-radius: 8px;
        text-align: center;
        font-size: 1.1rem;
        width: 100%;
        display: block;
    }
    
    .live-badge {
        order: 3;
        margin-left: auto;
        font-size: 0.7rem;
        padding: 0.3rem 0.8rem;
    }
    
    .wallet-section {
        order: 4;
        flex-direction: column;
        align-items: flex-end;
        gap: 0.3rem;
    }
    
    .wallet-info {
        font-size: 0.8rem;
    }
    
    .connect-btn, .disconnect-btn {
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
    }
}
/* MAIN LAYOUT */
.main-container {
    display: flex;
    min-height: 100vh;
    margin-top: 70px;
    overflow: hidden;
    position: relative;
    max-width: 100vw;
}

.sidebar {
    width: 300px;
    background: rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
    border-right: 1px solid rgba(255, 255, 255, 0.1);
    padding: 2rem;
    overflow-y: auto;
    max-height: calc(100vh - 70px);
    -webkit-overflow-scrolling: touch;
}

.content-area {
    flex: 1;
    padding: 2rem;
    overflow-y: auto;
    max-height: calc(100vh - 70px);
    -webkit-overflow-scrolling: touch;
    max-width: calc(100vw - 300px);
}

/* TRANSACTION STATUS */
.transaction-status {
    position: fixed;
    top: 80px;
    right: 10px;
    left: 10px;
    max-width: none;
    background: rgba(0, 0, 0, 0.95);
    border: 1px solid #4ecdc4;
    border-radius: 10px;
    padding: 1rem;
    z-index: 9999;
    transform: translateY(-100px);
    transition: transform 0.3s ease;
    word-wrap: break-word;
}

.transaction-status.show {
    transform: translateY(0);
}

.tx-hash {
    font-family: monospace;
    font-size: 0.8rem;
    word-break: break-all;
    color: #4ecdc4;
    margin-top: 0.5rem;
    cursor: pointer;
}

/* GAME SECTION STYLES */
.fee-info {
    background: rgba(255, 215, 0, 0.1);
    border: 1px solid rgba(255, 215, 0, 0.3);
    border-radius: 10px;
    padding: 2rem;
    margin-bottom: 2rem;
    text-align: center;
}

.fee-info h3 {
    color: #ffd700;
    margin-bottom: 1rem;
    font-size: 1.5rem;
}

.fee-info p {
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
}

.legal-notice {
    background: rgba(255, 193, 7, 0.1);
    border: 1px solid rgba(255, 193, 7, 0.3);
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.legal-notice h4 {
    color: #ffd700;
    margin-bottom: 1rem;
}

.legal-notice p {
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.games-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
    margin-top: 2rem;
}

.game-card {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.game-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    border-color: var(--primary);
}

.create-game-btn {
    width: 100%;
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
    border: none;
    padding: 1rem;
    border-radius: 10px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1rem;
    margin-top: 1rem;
}

.create-game-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
}

.stake-input {
    width: 100%;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    padding: 0.8rem;
    color: white;
    font-size: 1rem;
    margin: 1rem 0;
}

.stake-input::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

/* MOBILE LAYOUT */
@media (max-width: 768px) {
    .main-container {
        margin-top: 60px;
        flex-direction: column;
    }
    
    .sidebar {
        width: 100%;
        order: 2;
        padding: 1rem;
        max-height: none;
    }
    
    .content-area {
        order: 1;
        padding: 1rem;
        max-height: none;
        max-width: 100vw;
    }
    
    .games-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .transaction-status {
        top: 70px;
        right: 5px;
        left: 5px;
        font-size: 0.9rem;
        padding: 0.8rem;
    }
}

/* GAME COMPONENTS */
.active-games {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.game-lobby-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    margin: 0.5rem 0;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border-left: 3px solid #4ecdc4;
    transition: all 0.3s ease;
}

.game-lobby-item:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateX(5px);
}

.join-game-btn {
    background: linear-gradient(45deg, #00ff88, #00cc6a);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    color: black;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.join-game-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
}

/* NEWS FEED */
.news-feed {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    max-height: 400px;
    overflow-y: auto;
}

.news-item {
    padding: 1rem;
    margin: 0.5rem 0;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border-left: 3px solid #4ecdc4;
}

.news-title {
    font-weight: bold;
    margin-bottom: 0.5rem;
    color: #4ecdc4;
}

.news-time {
    font-size: 0.8rem;
    color: #aaa;
}
    </style>
</head>

<body>
    <div class="background"></div>
<div class="age-verification" id="ageVerificationModal">
    <div class="verification-content">
        <h1><i class="fas fa-exclamation-triangle"></i> Age Verification Required</h1>
        <p>This platform contains blockchain-based games that involve financial stakes. You must be 18 years or older to access this content.</p>
        <div class="warning">
            <p><i class="fas fa-exclamation-circle"></i> Gambling involves risk. Please play responsibly. Only gamble with funds you can afford to lose.</p>
        </div>
        <p>By entering this site, you confirm that you are at least 18 years of age and agree to our Terms of Service.</p>
        <button class="verify-btn accept" onclick="verifyAge(true)">I am 18+</button>
        <button class="verify-btn decline" onclick="verifyAge(false)">Under 18</button>
    </div>
</div>
<div class="header">
    <div class="logo">
        <i class="fas fa-dice-d20 logo-icon"></i>
        <h1>CRYPTICUS</h1>
    </div>
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()">☰</button>
    <div class="nav-menu" id="navMenu">
        <div class="nav-item active" onclick="showSection('games')">🎮 Games</div>
        <div class="nav-item" onclick="showSection('leaderboard')">🏆 Leaderboard</div>
        <div class="nav-item" onclick="showSection('profile')">👤 Profile</div>
        <div class="nav-item" onclick="showSection('chat')">💬 Chat</div>
        <div class="nav-item" onclick="showSection('news')">📰 News</div>
        <div class="nav-item" onclick="showSection('settings')">⚙️ Settings</div>
    </div>
    <div class="live-badge">🔴 LIVE ON CORE</div>
    <div class="wallet-section">
        <div class="wallet-info">
            <div class="connection-status" id="connectionStatus">🔴 Not Connected</div>
            <div class="balance" id="balanceDisplay">0.00 CORE</div>
        </div>
        <button class="connect-btn" id="connectBtn">
            <i class="fas fa-plug"></i> Connect Wallet
        </button>
        <button class="disconnect-btn hidden" id="disconnectBtn">Disconnect</button>
    </div>
</div>
<div class="transaction-status" id="transactionStatus">
    <div id="txStatusMessage">Processing transaction...</div>
    <div class="tx-hash" id="txHash"></div>
</div>
<div class="main-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="news-feed">
            <h3>📰 Live Game Feed</h3>
            <div id="gameFeed">
                <div class="news-item">
                    <div class="news-title">🎮 Active Games: <span id="activeGameCount">0</span></div>
                    <div class="news-time">Players online now</div>
                </div>
                <div class="news-item">
                    <div class="news-title">💰 Total Pool: <span id="totalPool">0 CORE</span></div>
                    <div class="news-time">Live betting volume</div>
                </div>
                <div class="news-item">
                    <div class="news-title">🏆 Last Winner: <span id="lastWinner">--</span></div>
                    <div class="news-time">Recent game result</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Area will be added in next section -->
</div>
  <!-- Add this HTML inside the content-area div, after the gamesSection -->

<!-- Chat Section -->
<div id="chatSection" class="hidden">
    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 1.5rem; height: 500px; display: flex; flex-direction: column;">
        <h3 style="margin-bottom: 1rem;">💬 Global Chat</h3>
        <div style="flex: 1; overflow-y: auto; margin-bottom: 1rem; padding: 1rem; background: rgba(0, 0, 0, 0.2); border-radius: 8px;" id="chatMessages">
            <!-- Chat messages will be added here by JavaScript -->
        </div>
        <div style="display: flex; gap: 0.5rem;">
            <input type="text" style="flex: 1; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; padding: 0.8rem; color: white;" placeholder="Type your message..." id="chatInput" onkeypress="handleChatKeyPress(event)">
            <button style="background: linear-gradient(45deg, #4ecdc4, #44a08d); border: none; padding: 0.8rem 1.5rem; border-radius: 8px; color: white; font-weight: bold; cursor: pointer;" onclick="sendChatMessage()">Send</button>
        </div>
    </div>
</div>

<!-- Profile Section -->
<div id="profileSection" class="hidden">
    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 1.5rem; margin-bottom: 2rem;">
        <h3 style="color: #4ecdc4; margin-bottom: 1rem;">👤 Player Profile</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 8px; text-align: center;">
                <h4 style="margin-bottom: 0.5rem; color: #aaa;">Games Played</h4>
                <p style="font-size: 2rem; font-weight: bold; color: #4ecdc4;" id="profileGamesPlayed">0</p>
            </div>
            <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 8px; text-align: center;">
                <h4 style="margin-bottom: 0.5rem; color: #aaa;">Games Won</h4>
                <p style="font-size: 2rem; font-weight: bold; color: #00ff88;" id="profileGamesWon">0</p>
            </div>
            <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 8px; text-align: center;">
                <h4 style="margin-bottom: 0.5rem; color: #aaa;">Total Earned</h4>
                <p style="font-size: 2rem; font-weight: bold; color: #ffd700;" id="profileTotalEarned">0 CORE</p>
            </div>
            <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 8px; text-align: center;">
                <h4 style="margin-bottom: 0.5rem; color: #aaa;">Win Rate</h4>
                <p style="font-size: 2rem; font-weight: bold; color: #ff6b6b;" id="profileWinRate">0%</p>
            </div>
        </div>
    </div>
</div>

<!-- Leaderboard Section -->
<div id="leaderboardSection" class="hidden">
    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 1.5rem;">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">🏆 Top Players This Week</h3>
        <div id="leaderboardList">
            <div style="padding: 1rem; margin: 0.5rem 0; background: rgba(255, 255, 255, 0.05); border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <span style="font-size: 1.5rem;">🥇</span>
                    <div>
                        <div style="font-weight: bold;">CryptoKing</div>
                        <div style="font-size: 0.8rem; color: #aaa;">15 wins • 2.3 CORE earned</div>
                    </div>
                </div>
            </div>
            <div style="padding: 1rem; margin: 0.5rem 0; background: rgba(255, 255, 255, 0.05); border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <span style="font-size: 1.5rem;">🥈</span>
                    <div>
                        <div style="font-weight: bold;">GameMaster</div>
                        <div style="font-size: 0.8rem; color: #aaa;">12 wins • 1.8 CORE earned</div>
                    </div>
                </div>
            </div>
            <div style="padding: 1rem; margin: 0.5rem 0; background: rgba(255, 255, 255, 0.05); border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <span style="font-size: 1.5rem;">🥉</span>
                    <div>
                        <div style="font-weight: bold;">BlockchainBro</div>
                        <div style="font-size: 0.8rem; color: #aaa;">10 wins • 1.5 CORE earned</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- News Section -->
<div id="newsSection" class="hidden">
    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 1.5rem;">
        <h3 style="color: #4ecdc4; margin-bottom: 1rem;">📰 Crypto Breaking News</h3>
        <div id="newsContent">
            <div style="padding: 1rem; margin: 0.5rem 0; background: rgba(255, 255, 255, 0.05); border-radius: 8px; border-left: 3px solid #4ecdc4;">
                <div style="font-weight: bold; margin-bottom: 0.5rem;">Core Blockchain Gaming Platform Launches</div>
                <div style="font-size: 0.9rem; color: #aaa; margin-bottom: 0.5rem;">Revolutionary gaming platform now live on Core mainnet with provably fair games.</div>
                <div style="font-size: 0.8rem; color: #666;">2 hours ago</div>
            </div>
            <div style="padding: 1rem; margin: 0.5rem 0; background: rgba(255, 255, 255, 0.05); border-radius: 8px; border-left: 3px solid #4ecdc4;">
                <div style="font-weight: bold; margin-bottom: 0.5rem;">Smart Contract Security Audit Complete</div>
                <div style="font-size: 0.9rem; color: #aaa; margin-bottom: 0.5rem;">Gaming contracts pass comprehensive security review with flying colors.</div>
                <div style="font-size: 0.8rem; color: #666;">6 hours ago</div>
            </div>
        </div>
    </div>
</div>

<!-- Settings Section -->
<div id="settingsSection" class="hidden">
    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 1.5rem;">
        <h3 style="margin-bottom: 1rem;">⚙️ Platform Settings</h3>
        <div id="settingsContent">
            <div style="margin-bottom: 2rem;">
                <h4 style="margin-bottom: 1rem; color: #4ecdc4;">Game Preferences</h4>
                <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                    <input type="checkbox" id="soundEnabled" style="margin-right: 0.5rem;">
                    <label for="soundEnabled">Enable sound effects</label>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                    <input type="checkbox" id="notificationsEnabled" style="margin-right: 0.5rem;">
                    <label for="notificationsEnabled">Enable notifications</label>
                </div>
            </div>
            <div style="margin-bottom: 2rem;">
                <h4 style="margin-bottom: 1rem; color: #4ecdc4;">Network Settings</h4>
                <p style="margin-bottom: 0.5rem;">Current Network: Core Blockchain Mainnet</p>
                <p style="font-size: 0.9rem; color: #aaa;">Chain ID: 1116</p>
            </div>
        </div>
    </div>
</div>
    
    <!-- Content will be added in following sections -->
  <!-- Add this JavaScript before the closing </body> tag -->
<script>
// BLOCKCHAIN INTEGRATION WITH ERROR HANDLING

const CONTRACT_ADDRESS = "0x7af2cB8f93D0a75E0ba39E974B4e968EAe49028A";
const CORE_CHAIN_ID = "0x45c"; // Core Mainnet Chain ID (1116 in decimal)

// Global Variables
let web3Provider = null;
let userAccount = null;
let gameContract = null;
let currentBalance = 0;
let isConnecting = false;
let activeGames = [];

// Simplified Contract ABI
const CONTRACT_ABI = [
    "function createGame(uint256 gameType) external payable returns (uint256)",
    "function joinGame(uint256 gameId) external payable",
    "function getGameState(uint256 gameId) external view returns (uint8, address, address, uint256)"
];

// Enhanced Web3 initialization
async function initializeWeb3() {
    try {
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        if (typeof window.ethereum !== 'undefined') {
            web3Provider = new ethers.providers.Web3Provider(window.ethereum);
            
            const network = await web3Provider.getNetwork();
            console.log('Current network:', network);
            
            if (network.chainId !== parseInt(CORE_CHAIN_ID, 16)) {
                const switched = await switchToCore();
                if (!switched) {
                    throw new Error('Please switch to Core network manually');
                }
            }
            
            return true;
        } else {
            if (isMobile) {
                showTransactionStatus('❌ Please open in MetaMask browser or install MetaMask mobile app', '');
                setTimeout(() => {
                    window.location.href = `https://metamask.app.link/dapp/${window.location.host}`;
                }, 3000);
            } else {
                showTransactionStatus('❌ MetaMask not detected. Please install MetaMask extension.', '');
            }
            return false;
        }
    } catch (error) {
        console.error('Web3 initialization error:', error);
        showTransactionStatus('❌ Failed to initialize Web3: ' + error.message, '');
        return false;
    }
}

// Enhanced network switching
async function switchToCore() {
    try {
        await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: CORE_CHAIN_ID }],
        });
        return true;
    } catch (switchError) {
        console.log('Switch error:', switchError);
        
        if (switchError.code === 4902 || switchError.code === -32602) {
            try {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                        chainId: CORE_CHAIN_ID,
                        chainName: 'Core Blockchain Mainnet',
                        nativeCurrency: {
                            name: 'CORE',
                            symbol: 'CORE',
                            decimals: 18
                        },
                        rpcUrls: ['https://rpc.coredao.org', 'https://rpc-core.icecreamswap.com'],
                        blockExplorerUrls: ['https://scan.coredao.org']
                    }],
                });
                return true;
            } catch (addError) {
                console.error('Add network error:', addError);
                showTransactionStatus('❌ Failed to add Core network. Please add manually.', '');
                return false;
            }
        } else if (switchError.code === 4001) {
            showTransactionStatus('❌ User rejected network switch', '');
            return false;
        } else {
            showTransactionStatus('❌ Failed to switch network: ' + switchError.message, '');
            return false;
        }
    }
}

// Enhanced wallet connection
async function connectWallet() {
    if (isConnecting) {
        showTransactionStatus('⏳ Connection already in progress...', '');
        return;
    }
    
    isConnecting = true;
    
    try {
        showTransactionStatus('🔄 Connecting wallet...', '');
        
        if (!await initializeWeb3()) {
            isConnecting = false;
            return;
        }

        const accounts = await window.ethereum.request({
            method: 'eth_requestAccounts'
        });
        
        if (!accounts || accounts.length === 0) {
            throw new Error('No accounts found. Please unlock MetaMask.');
        }

        userAccount = accounts[0];
        
        // Get balance with retry logic
        let balance;
        let retries = 3;
        while (retries > 0) {
            try {
                balance = await web3Provider.getBalance(userAccount);
                break;
            } catch (balanceError) {
                retries--;
                if (retries === 0) throw balanceError;
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }
        
        currentBalance = parseFloat(ethers.utils.formatEther(balance));
        
        // Initialize contract with signer
        const signer = web3Provider.getSigner();
        gameContract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
        
        // Update UI
        updateWalletUI(true);
        
        showTransactionStatus('✅ Wallet connected successfully!', '');
        
        // Load active games
        await loadActiveGames();
        
        // Set up event listeners
        setupEventListeners();
        
    } catch (error) {
        console.error('Wallet connection error:', error);
        handleConnectionError(error);
    } finally {
        isConnecting = false;
    }
}

// Enhanced error handling
function handleConnectionError(error) {
    let errorMessage = 'Unknown error occurred';
    
    if (error.code === 4001) {
        errorMessage = 'Connection rejected by user';
    } else if (error.code === -32002) {
        errorMessage = 'Connection request pending. Check MetaMask.';
    } else if (error.message.includes('network')) {
        errorMessage = 'Network connection issue. Please check your internet.';
    } else if (error.message.includes('accounts')) {
        errorMessage = 'No accounts found. Please unlock MetaMask.';
    } else {
        errorMessage = error.message || 'Failed to connect wallet';
    }
    
    showTransactionStatus('❌ ' + errorMessage, '');
}

// Update wallet UI
function updateWalletUI(connected) {
    if (connected) {
        document.getElementById('connectionStatus').innerHTML = '🟢 Connected';
        document.getElementById('balanceDisplay').textContent = currentBalance.toFixed(4) + ' CORE';
        document.getElementById('connectBtn').classList.add('hidden');
        document.getElementById('disconnectBtn').classList.remove('hidden');
    } else {
        document.getElementById('connectionStatus').innerHTML = '🔴 Not Connected';
        document.getElementById('balanceDisplay').textContent = '0.00 CORE';
        document.getElementById('connectBtn').classList.remove('hidden');
        document.getElementById('disconnectBtn').classList.add('hidden');
    }
}

// Enhanced game creation with better error handling
async function createGameOnChain(gameType, stakeAmount) {
    if (!gameContract || !userAccount) {
        throw new Error('Wallet not connected');
    }
    
    if (stakeAmount > currentBalance) {
        throw new Error('Insufficient CORE balance');
    }
    
    try {
        const stakeWei = ethers.utils.parseEther(stakeAmount.toString());
        
        showTransactionStatus('🔄 Creating game on blockchain...', '');
        
        // Estimate gas first
        let gasEstimate;
        try {
            gasEstimate = await gameContract.estimateGas.createGame(gameType, { 
                value: stakeWei,
                from: userAccount
            });
            gasEstimate = gasEstimate.mul(120).div(100); // Add 20% buffer
        } catch (gasError) {
            console.warn('Gas estimation failed, using default:', gasError);
            gasEstimate = ethers.BigNumber.from('300000');
        }
        
        const gasPrice = await web3Provider.getGasPrice();
        
        const tx = await gameContract.createGame(gameType, { 
            value: stakeWei,
            gasLimit: gasEstimate,
            gasPrice: gasPrice
        });
        
        showTransactionStatus('⏳ Transaction submitted. Waiting for confirmation...', tx.hash);
        
        const receipt = await tx.wait(1);
        
        showTransactionStatus('✅ Game created successfully!', tx.hash);
        
        // Update balance
        const newBalance = await web3Provider.getBalance(userAccount);
        currentBalance = parseFloat(ethers.utils.formatEther(newBalance));
        updateWalletUI(true);
        
        // Extract game ID from receipt
        let gameId = Date.now(); // Fallback to timestamp
        if (receipt.logs && receipt.logs.length > 0) {
            try {
                gameId = parseInt(receipt.logs[0].topics[1], 16);
            } catch (parseError) {
                console.warn('Could not parse game ID from logs');
            }
        }
        
        return gameId;
        
    } catch (error) {
        console.error('Game creation error:', error);
        
        if (error.code === 4001) {
            throw new Error('Transaction rejected by user');
        } else if (error.code === -32603) {
            throw new Error('Transaction failed. Please check your balance and try again.');
        } else if (error.message.includes('insufficient funds')) {
            throw new Error('Insufficient CORE for transaction fees');
        } else if (error.message.includes('gas')) {
            throw new Error('Transaction failed due to gas issues. Please try again.');
        } else {
            throw new Error(error.reason || error.message || 'Transaction failed');
        }
    }
}

// Setup event listeners
function setupEventListeners() {
    if (!window.ethereum) return;
    
    window.ethereum.on('accountsChanged', handleAccountsChanged);
    window.ethereum.on('chainChanged', handleChainChanged);
    window.ethereum.on('disconnect', handleDisconnect);
}

// Handle account changes
function handleAccountsChanged(accounts) {
    if (accounts.length === 0) {
        disconnectWallet();
    } else if (accounts[0] !== userAccount) {
        userAccount = accounts[0];
        connectWallet();
    }
}

// Handle chain changes
function handleChainChanged(chainId) {
    if (chainId !== CORE_CHAIN_ID) {
        showTransactionStatus('⚠️ Please switch to Core network', '');
        disconnectWallet();
    } else {
        if (userAccount) {
            connectWallet();
        }
    }
}

// Handle disconnect
function handleDisconnect(error) {
    console.log('Wallet disconnected:', error);
    disconnectWallet();
}

// Disconnect wallet
function disconnectWallet() {
    userAccount = null;
    currentBalance = 0;
    gameContract = null;
    
    updateWalletUI(false);
    showTransactionStatus('👋 Wallet disconnected', '');
}

// Load active games
async function loadActiveGames() {
    try {
        activeGames = [];
        updateActiveGamesDisplay();
        updateGameStats();
    } catch (error) {
        console.error('Failed to load active games:', error);
    }
}

// Event listeners
document.getElementById('connectBtn').addEventListener('click', connectWallet);
document.getElementById('disconnectBtn').addEventListener('click', disconnectWallet);

// Auto-connect if previously connected
document.addEventListener('DOMContentLoaded', async () => {
    if (localStorage.getItem('walletConnected') === 'true') {
        setTimeout(connectWallet, 1000);
    }
});

// Store connection state
window.addEventListener('beforeunload', () => {
    if (userAccount) {
        localStorage.setItem('walletConnected', 'true');
    } else {
        localStorage.removeItem('walletConnected');
    }
});
</script>
  <!-- Add this JavaScript after the blockchain integration script -->
<script>
// GAME LOGIC & MANAGEMENT

let currentSection = 'games';
let playerStats = {
    gamesPlayed: 0,
    gamesWon: 0,
    totalEarned: 0,
    chess: { wins: 0, losses: 0 },
    checkers: { wins: 0, losses: 0 },
    words: { wins: 0, losses: 0 }
};

// Navigation functions
function showSection(section) {
    // Hide all sections
    document.querySelectorAll('[id$="Section"]').forEach(el => el.classList.add('hidden'));
    
    // Show selected section
    const sectionElement = document.getElementById(section + 'Section');
    if (sectionElement) {
        sectionElement.classList.remove('hidden');
    }
    
    // Update active nav item
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.target.classList.add('active');
    
    currentSection = section;
    
    // Close mobile menu
    document.getElementById('navMenu').classList.remove('active');
    
    // Update profile if needed
    if (section === 'profile') updateProfileDisplay();
}

function toggleMobileMenu() {
    const navMenu = document.getElementById('navMenu');
    navMenu.classList.toggle('active');
}

// Game Creation Functions
async function createChessGame() {
    const stakeAmount = parseFloat(document.getElementById('chessStake').value);
    if (!validateStakeAndWallet(stakeAmount)) return;
    
    try {
        showTransactionStatus('🔄 Creating Chess game...', '');
        
        const gameId = await createGameOnChain(0, stakeAmount); // 0 = Chess
        
        const newGame = {
            id: gameId,
            type: 'chess',
            creator: userAccount,
            stake: stakeAmount,
            status: 'waiting',
            timestamp: Date.now()
        };
        
        activeGames.push(newGame);
        updateActiveGamesDisplay();
        
        playerStats.gamesPlayed++;
        updateProfileDisplay();
        
        document.getElementById('chessStake').value = '';
        
        showTransactionStatus('✅ Chess game created successfully!', '');
        
    } catch (error) {
        showTransactionStatus('❌ Failed to create Chess game: ' + error.message, '');
    }
}

async function createCheckersGame() {
    const stakeAmount = parseFloat(document.getElementById('checkersStake').value);
    if (!validateStakeAndWallet(stakeAmount)) return;
    
    try {
        showTransactionStatus('🔄 Creating Checkers game...', '');
        
        const gameId = await createGameOnChain(1, stakeAmount); // 1 = Checkers
        
        const newGame = {
            id: gameId,
            type: 'checkers',
            creator: userAccount,
            stake: stakeAmount,
            status: 'waiting',
            timestamp: Date.now()
        };
        
        activeGames.push(newGame);
        updateActiveGamesDisplay();
        
        playerStats.gamesPlayed++;
        updateProfileDisplay();
        
        document.getElementById('checkersStake').value = '';
        
        showTransactionStatus('✅ Checkers game created successfully!', '');
        
    } catch (error) {
        showTransactionStatus('❌ Failed to create Checkers game: ' + error.message, '');
    }
}

async function createWordGame() {
    const stakeAmount = parseFloat(document.getElementById('wordStake').value);
    if (!validateStakeAndWallet(stakeAmount)) return;
    
    try {
        showTransactionStatus('🔄 Creating Word game...', '');
        
        const gameId = await createGameOnChain(2, stakeAmount); // 2 = Word Battle
        
        const newGame = {
            id: gameId,
            type: 'words',
            creator: userAccount,
            stake: stakeAmount,
            status: 'waiting',
            timestamp: Date.now()
        };
        
        activeGames.push(newGame);
        updateActiveGamesDisplay();
        
        playerStats.gamesPlayed++;
        updateProfileDisplay();
        
        document.getElementById('wordStake').value = '';
        
        showTransactionStatus('✅ Word game created successfully!', '');
        
    } catch (error) {
        showTransactionStatus('❌ Failed to create Word game: ' + error.message, '');
    }
}

// Validation function
function validateStakeAndWallet(stakeAmount) {
    if (!userAccount) {
        showTransactionStatus('❌ Please connect your wallet first', '');
        return false;
    }
    
    if (!stakeAmount || stakeAmount < 0.01) {
        showTransactionStatus('❌ Please enter a valid stake amount (minimum 0.01 CORE)', '');
        return false;
    }
    
    if (stakeAmount > currentBalance) {
        showTransactionStatus('❌ Insufficient CORE balance', '');
        return false;
    }
    
    return true;
}

// Game joining function
async function joinGame(gameType, gameId, stakeAmount) {
    if (!userAccount) {
        showTransactionStatus('❌ Please connect your wallet first', '');
        return;
    }
    
    if (currentBalance < stakeAmount) {
        showTransactionStatus('❌ Insufficient CORE balance', '');
        return;
    }
    
    try {
        showTransactionStatus('🔄 Joining game...', '');
        
        // Simulate joining game on chain
        const stakeWei = ethers.utils.parseEther(stakeAmount.toString());
        const tx = await gameContract.joinGame(gameId, { value: stakeWei });
        
        showTransactionStatus('⏳ Transaction submitted. Waiting for confirmation...', tx.hash);
        
        const receipt = await tx.wait(1);
        
        showTransactionStatus('✅ Successfully joined game!', tx.hash);
        
        // Remove game from active games list
        activeGames = activeGames.filter(game => game.id !== gameId);
        updateActiveGamesDisplay();
        
        playerStats.gamesPlayed++;
        updateProfileDisplay();
        
        // Update balance
        const newBalance = await web3Provider.getBalance(userAccount);
        currentBalance = parseFloat(ethers.utils.formatEther(newBalance));
        updateWalletUI(true);
        
    } catch (error) {
        showTransactionStatus('❌ Failed to join game: ' + error.message, '');
    }
}

// Update active games display
function updateActiveGamesDisplay() {
    const gamesList = document.getElementById('activeGamesList');
    const noGamesDiv = document.getElementById('noActiveGames');
    
    // Clear existing content
    gamesList.innerHTML = '';
    
    if (activeGames.length === 0) {
        gamesList.appendChild(noGamesDiv);
        noGamesDiv.classList.remove('hidden');
        updateGameStats();
        return;
    }
    
    noGamesDiv.classList.add('hidden');
    
    activeGames.forEach(game => {
        const gameDiv = document.createElement('div');
        gameDiv.className = 'game-lobby-item';
        
        const gameIcon = game.type === 'chess' ? '♟️' : 
                        game.type === 'checkers' ? '⚫' : '📝';
        const gameName = game.type === 'chess' ? 'Chess Masters' : 
                       game.type === 'checkers' ? 'Checkers Pro' : 'Word Battle';
        
        const timeAgo = Math.floor((Date.now() - game.timestamp) / 60000);
        const creator = game.creator === userAccount ? 'You' : 
                       game.creator.substring(0, 6) + '...' + game.creator.substring(38);
        
        gameDiv.innerHTML = `
            <div>
                <strong>${gameIcon} ${gameName}</strong>
                <div style="font-size: 0.9rem; color: #aaa;">
                    ${creator} • Stake: ${game.stake} CORE • ${timeAgo}m ago
                </div>
            </div>
            ${game.creator !== userAccount ? 
                `<button class="join-game-btn" onclick="joinGame('${game.type}', ${game.id}, ${game.stake})">
                    Join Game
                </button>` : 
                `<span style="color: #ffd700; font-weight: bold;">Your Game</span>`
            }
        `;
        
        gamesList.appendChild(gameDiv);
    });
    
    updateGameStats();
}

// Transaction status display
function showTransactionStatus(message, txHash = '') {
    const statusDiv = document.getElementById('transactionStatus');
    const messageDiv = document.getElementById('txStatusMessage');
    const hashDiv = document.getElementById('txHash');
    
    messageDiv.textContent = message;
    hashDiv.textContent = txHash ? `TX: ${txHash.substring(0, 10)}...${txHash.substring(56)}` : '';
    hashDiv.onclick = txHash ? () => window.open(`https://scan.coredao.org/tx/${txHash}`, '_blank') : null;
    hashDiv.style.cursor = txHash ? 'pointer' : 'default';
    
    statusDiv.classList.add('show');
    
    setTimeout(() => statusDiv.classList.remove('show'), 5000);
}

// Profile update
function updateProfileDisplay() {
    document.getElementById('profileGamesPlayed').textContent = playerStats.gamesPlayed;
    document.getElementById('profileGamesWon').textContent = playerStats.gamesWon;
    document.getElementById('profileTotalEarned').textContent = playerStats.totalEarned.toFixed(4) + ' CORE';
    
    const winRate = playerStats.gamesPlayed > 0 ?
        ((playerStats.gamesWon / playerStats.gamesPlayed) * 100).toFixed(1) : 0;
    document.getElementById('profileWinRate').textContent = winRate + '%';
}

// Update game statistics
function updateGameStats() {
    const activeCount = activeGames.length;
    const totalPool = activeGames.reduce((sum, game) => sum + game.stake, 0);
    
    document.getElementById('activeGameCount').textContent = activeCount;
    document.getElementById('totalPool').textContent = totalPool.toFixed(2) + ' CORE';
    
    const winners = ['CryptoKing', 'GameMaster', 'BlockchainBro', 'TokenMaster', 'WordWizard'];
    document.getElementById('lastWinner').textContent = winners[Math.floor(Math.random() * winners.length)];
}

// Age verification
function verifyAge(isAdult) {
    if (isAdult) {
        document.getElementById('ageVerificationModal').style.display = 'none';
        sessionStorage.setItem('ageVerified', 'true');
        showTransactionStatus('✅ Age verified. Welcome to Crypticus!');
    } else {
        alert('Sorry, you must be 18 or older to use this platform.');
        window.location.href = 'https://www.google.com';
    }
}

function checkAgeVerification() {
    if (!sessionStorage.getItem('ageVerified')) {
        document.getElementById('ageVerificationModal').style.display = 'flex';
    }
}

// CHAT SYSTEM
function sendChatMessage() {
    const chatInput = document.getElementById('chatInput');
    const message = chatInput.value.trim();
    
    if (!message) return;
    
    if (!userAccount) {
        showTransactionStatus('⚠️ Please connect your wallet to chat', '');
        return;
    }
    
    addChatMessage('You', message);
    chatInput.value = '';
    
    // Simulate responses
    setTimeout(() => {
        const responses = [
            "Good luck in your games! 🎮",
            "Welcome to Crypticus! 🚀", 
            "Let's play some games! ⚔️",
            "Nice strategy! 🧠",
            "The blockchain gaming future is here! 💎"
        ];
        const randomUser = ['CryptoKing', 'GameMaster', 'BlockchainBro'][Math.floor(Math.random() * 3)];
        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
        addChatMessage(randomUser, randomResponse);
    }, 1000 + Math.random() * 3000);
}

function addChatMessage(user, message) {
    const chatMessages = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.style.cssText = 'margin-bottom: 0.8rem; padding: 0.5rem; border-radius: 8px; background: rgba(255, 255, 255, 0.05);';
    messageDiv.innerHTML = `<strong>${user}:</strong> ${message}`;
    
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    // Keep only last 50 messages
    while (chatMessages.children.length > 50) {
        chatMessages.removeChild(chatMessages.firstChild);
    }
}

function handleChatKeyPress(event) {
    if (event.key === 'Enter') {
        sendChatMessage();
    }
}
</script>
  <!-- Add this JavaScript after the game logic script -->
<script>
// INITIALIZATION AND FINAL SETUP

// INITIALIZATION
document.addEventListener('DOMContentLoaded', () => {
    console.log('🚀 Crypticus Platform Initialized');
    
    // Check age verification
    checkAgeVerification();
    
    // Initialize displays
    updateActiveGamesDisplay();
    updateProfileDisplay();
    
    // Initialize sample chat messages
    addChatMessage('System', 'Welcome to Crypticus! Connect your wallet to start playing.');
    addChatMessage('CryptoKing', 'Just won 2.5 CORE in Chess! 🎉');
    addChatMessage('GameMaster', 'New high stakes games available!');
    
    // Auto-hide transaction status on click
    document.getElementById('transactionStatus').addEventListener('click', () => {
        document.getElementById('transactionStatus').classList.remove('show');
    });
    
    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
        const navMenu = document.getElementById('navMenu');
        const mobileBtn = document.querySelector('.mobile-menu-btn');
        
        if (!navMenu.contains(e.target) && e.target !== mobileBtn && 
            !mobileBtn.contains(e.target) && navMenu.classList.contains('active')) {
            navMenu.classList.remove('active');
        }
    });
    
    // Auto-update game stats every 30 seconds
    setInterval(() => {
        updateGameStats();
    }, 30000);
    
    // Simulate some activity for demo
    setTimeout(() => {
        // Add a sample game after 5 seconds for demo
        if (activeGames.length === 0) {
            const sampleGame = {
                id: Date.now(),
                type: 'chess',
                creator: '0x1234...5678',
                stake: 0.1,
                status: 'waiting',
                timestamp: Date.now() - 120000 // 2 minutes ago
            };
            activeGames.push(sampleGame);
            updateActiveGamesDisplay();
        }
    }, 5000);
});

// Additional utility functions
function formatAddress(address) {
    if (!address) return '--';
    return address.substring(0, 6) + '...' + address.substring(38);
}

function formatTimestamp(timestamp) {
    const now = Date.now();
    const diff = now - timestamp;
    const minutes = Math.floor(diff / 60000);
    const hours = Math.floor(diff / 3600000);
    const days = Math.floor(diff / 86400000);
    
    if (days > 0) return `${days}d ago`;
    if (hours > 0) return `${hours}h ago`;
    if (minutes > 0) return `${minutes}m ago`;
    return 'Just now';
}

// Error boundary for unhandled errors
window.addEventListener('error', (event) => {
    console.error('Unhandled error:', event.error);
    showTransactionStatus('❌ An unexpected error occurred. Please refresh the page.', '');
});

// Handle unhandled promise rejections
window.addEventListener('unhandledrejection', (event) => {
    console.error('Unhandled promise rejection:', event.reason);
    showTransactionStatus('❌ Connection error. Please check your network and try again.', '');
});

// Prevent form submission on enter in input fields
document.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && e.target.type === 'number') {
        e.preventDefault();
        
        // Trigger appropriate game creation based on input field
        const inputId = e.target.id;
        if (inputId === 'chessStake') {
            createChessGame();
        } else if (inputId === 'checkersStake') {
            createCheckersGame();
        } else if (inputId === 'wordStake') {
            createWordGame();
        }
    }
});

// Handle page visibility changes
document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible' && userAccount) {
        // Refresh balance when page becomes visible
        setTimeout(async () => {
            try {
                const balance = await web3Provider.getBalance(userAccount);
                currentBalance = parseFloat(ethers.utils.formatEther(balance));
                updateWalletUI(true);
            } catch (error) {
                console.error('Failed to update balance:', error);
            }
        }, 1000);
    }
});

// Mobile-specific optimizations
if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
    // Prevent zoom on double tap
    document.addEventListener('touchend', function(event) {
        const now = new Date().getTime();
        const timesince = now - lastTouchEnd;
        if ((timesince < 300) && (timesince > 0)) {
            event.preventDefault();
        }
        lastTouchEnd = now;
    }, false);
    
    let lastTouchEnd = 0;
    
    // Improve touch responsiveness
    document.addEventListener('touchstart', function() {}, {passive: true});
    document.addEventListener('touchmove', function() {}, {passive: true});
}

// Performance monitoring
let performanceMetrics = {
    pageLoadTime: 0,
    walletConnectionTime: 0,
    transactionTimes: []
};

window.addEventListener('load', () => {
    performanceMetrics.pageLoadTime = performance.now();
    console.log(`Page loaded in ${performanceMetrics.pageLoadTime.toFixed(2)}ms`);
});

// Cleanup on page unload
window.addEventListener('beforeunload', () => {
    // Clean up any intervals or timers
    if (window.gameStatsInterval) {
        clearInterval(window.gameStatsInterval);
    }
    
    // Save any important state to localStorage
    if (userAccount) {
        localStorage.setItem('lastConnectedAccount', userAccount);
    }
});

console.log('✅ Crypticus platform fully initialized and ready!');
</script>

<!-- Close the content-area and main-container divs -->
</div> <!-- End content-area -->
</div> <!-- End main-container -->

<!-- Close body and html tags -->
</body>
</html>
